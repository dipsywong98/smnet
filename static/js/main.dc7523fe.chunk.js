(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{133:function(e,t,n){e.exports=n(240)},138:function(e,t,n){},140:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=140},145:function(e,t){},147:function(e,t){},157:function(e,t){},159:function(e,t){},186:function(e,t){},187:function(e,t){},192:function(e,t){},194:function(e,t){},218:function(e,t){},240:function(e,t,n){"use strict";n.r(t);var r,a=n(1),i=n.n(a),c=n(131),o=n.n(c),s=(n(138),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,243)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))}),u=n(0),l=n.n(u),f=n(2),h=n(6),p=n(242),d=n(19),v=n(20),b=n(7),m=n(3),y=n(10),O=n(52),w=n(17),g=n(18),k=n(45),j=n(15),E=n(132),S=n.n(E),A=n(43),C=n.n(A),x=n(42),_=n(34),P=n.n(_);!function(e){e.DISPATCH="DISPATCH",e.ACK="ACK",e.NACK="NACK",e.PROMOTE="PROMOTE",e.CANCEL="CANCEL",e.SET_STATE="SET_STATE",e.ASK_STATE="ASK_STATE",e.KICK="KICK"}(r||(r={}));var T,D=function(){function e(t){if(Object(y.a)(this,e),void 0!==t)this._options=t;else{var n,r,a,i=Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_CONFIG;if(void 0===i&&void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_HOST)this._options=void 0;else this._options={host:null!==(n=Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_HOST)&&void 0!==n?n:"localhost",port:Number.parseInt(null!==(r=Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_PORT)&&void 0!==r?r:"9000",10),path:null!==(a=Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_PATH)&&void 0!==a?a:"/peer",secure:"true"===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_PEER_SECURE,config:void 0!==i?JSON.parse(i):void 0}}}return Object(j.a)(e,[{key:"make",value:function(e){return new S.a(e,this._options)}},{key:"makeAndOpen",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.make(t),e.next=3,new Promise((function(e,t){n.on("open",(function(){e(n)})),n.on("error",(function(){t(n)}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),L=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(y.a)(this,n),(e=t.apply(this,arguments)).message="already joined network",e.name="AlreadyJoinedNetworkError",e}return n}(Object(k.a)(Error)),R=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(y.a)(this,n),(r=t.call(this)).name="PlayerNameAlreadyExistError",r.message="not connected to ".concat(e),r}return n}(Object(k.a)(Error)),N=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(y.a)(this,n),(e=t.apply(this,arguments)).message="No Staging State",e.name="NoStagingStateError",e}return n}(Object(k.a)(Error)),I=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(y.a)(this,n),(e=t.apply(this,arguments)).message="Network is busy, please retry later",e.name="NetworkBusyError",e}return n}(Object(k.a)(Error));!function(e){e[e.ALL=0]="ALL",e[e.TRACE=1]="TRACE",e[e.LOG=2]="LOG",e[e.DEBUG=3]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=5]="WARN",e[e.ERROR=6]="ERROR",e[e.OFF=7]="OFF"}(T||(T={}));var M=function(){function e(t,n,r){var a=this;Object(y.a)(this,e),this._logs=[],this.pushLog=function(e,t){a._logs.length>=a._keep&&a._logs.shift();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];a._logs.push({level:e,message:r,date:new Date})},this.getLogFunction=function(e){if(e<a._verboseLevel)return function(){};switch(e){case T.INFO:return console.info.bind(window.console);case T.LOG:case T.DEBUG:return console.log.bind(window.console);case T.ERROR:return console.error.bind(window.console);case T.WARN:return console.warn.bind(window.console);case T.TRACE:return console.trace.bind(window.console);default:return function(){}}},this.withColor=function(e,t){return function(n){var r,a=(r={},Object(b.a)(r,T.INFO,"color: DodgerBlue"),Object(b.a)(r,T.LOG,""),Object(b.a)(r,T.DEBUG,"color: Green"),Object(b.a)(r,T.ERROR,""),Object(b.a)(r,T.WARN,""),Object(b.a)(r,T.TRACE,"color: Green"),Object(b.a)(r,T.ALL,""),Object(b.a)(r,T.OFF,""),r)[e],i=void 0===t?"%c[".concat(T[e],"]"):"%c[".concat(t.toISOString()," ").concat(T[e],"]");return Function.prototype.bind.call(n,console,i,a)}},this.withHistoryButWrongLineNumber=function(e){return function(t){return new Proxy(t,{apply:function(t,n,r){var i=new Date;return a.pushLog.apply(a,[e,i].concat(Object(O.a)(r))),t.apply(void 0,Object(O.a)(r))}})}},this.withAllFeatures=function(e){return e>=a._historyLevel?a.withHistoryButWrongLineNumber(e)(a.withColor(e)(a.getLogFunction(e))):a.withColor(e)(a.getLogFunction(e))},this.clear=function(){a._logs.splice(0,a._logs.length)},this.printLogs=function(){a._logs.forEach((function(e){var t=e.level,n=e.message,r=e.date;a.withColor(t,r)(a.getLogFunction(t)).apply(void 0,Object(O.a)(n))}))},this.getLogs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.ALL;return a._logs.filter((function(t){return t.level>=e}))},this._historyLevel=t,this._verboseLevel=n,this._keep=r}return Object(j.a)(e,[{key:"historyLevel",set:function(e){this._historyLevel=e}},{key:"verboseLevel",set:function(e){this._verboseLevel=e}},{key:"keep",set:function(e){this._keep=e}},{key:"info",get:function(){return this.withAllFeatures(T.INFO)}},{key:"log",get:function(){return this.withAllFeatures(T.LOG)}},{key:"debug",get:function(){return this.withAllFeatures(T.DEBUG)}},{key:"error",get:function(){return this.withAllFeatures(T.ERROR)}},{key:"warn",get:function(){return this.withAllFeatures(T.WARN)}},{key:"trace",get:function(){return this.withAllFeatures(T.TRACE)}}]),e}(),K=new M(T.ALL,T.WARN,100);void 0!==Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SMNET_VERBOSE_ALL_NO_HISTORY&&(K.historyLevel=T.OFF,K.verboseLevel=T.ALL);var H,F,W=function(){function e(t,n){Object(y.a)(this,e),this.isAdmin=!0,this.leaving=!1,this.network=t,this.peerFactory=n}return Object(j.a)(e,[{key:"handlePromote",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=12;break}if((n=C()(JSON.stringify(this.stagingState)))!==t){e.next=8;break}this.network.setState(this.stagingState),K.info("promoted the stagingState",this.stagingState),this.stagingState=void 0,e.next=10;break;case 8:throw K.error("Cannot promote, staging checksum is ".concat(n," while requested to promote checksum of ").concat(t)),new Error("Cannot promote staging state with unmatched checksum");case 10:e.next=14;break;case 12:throw K.error("Cannot promote, there is no staging state"),new N;case 14:return e.next=16,Promise.resolve();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleCancel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=11;break}if((n=C()(JSON.stringify(this.stagingState)))!==t){e.next=7;break}K.info("canceled the stagingState",this.stagingState),this.stagingState=void 0,e.next=9;break;case 7:throw K.error("Cannot cancel, staging checksum is ".concat(n," while requested to cancel checksum of ").concat(t)),new Error("Cannot cancel staging state with unmatched checksum");case 9:e.next=13;break;case 11:throw K.error("Cannot cancel, there is no staging state"),new N;case 13:return e.next=15,Promise.resolve();case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){K.info("force cancel the stagingState"),this.stagingState=void 0}},{key:"isBusy",value:function(){return void 0!==this.stagingState}}]),e}(),U=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout((function(){e()}),t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a,i,c,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,K.debug("reduce locally",this.network.getState(),t),this.stagingState=this.network.applyReducer(this.network.getState(),t),a=C()(JSON.stringify(this.stagingState)),K.debug("stagingState",this.stagingState),e.next=7,this.network.broadcast(r.DISPATCH,t);case 7:if(i=e.sent,K.debug("obtained responses",i),c=[],o=[],s=[],i.forEach((function(e){var t=e.conn,n=e.data,r=e.error;void 0!==r?c.push({error:r,conn:t}):n!==a?o.push(t):s.push(t)})),s.length===i.length?K.debug("all can be promoted"):(c.length>0&&K.error("received ".concat(c.length," error from some peers"),c),o.length>0&&K.warn("received ".concat(o.length," unmatched checksum from some peer, forceUpdating them"),o)),!(c.length>0)){e.next=20;break}return e.next=17,this.network.broadcast(r.CANCEL,a);case 17:throw new Error(c[0].error);case 20:o.map(function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.SET_STATE,n.stagingState);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.map(function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.PROMOTE,a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 22:return e.next=24,this.handlePromote(a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch(n);case 2:return e.abrupt("return",this.network.getState());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.dispatchMemberLeft(e.peer).catch(K.error)}))}},{key:"dispatchMemberLeft",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.leaving){e.next=12;break}return e.prev=1,e.next=4,this.network.dispatch({type:"member-left",payload:t});case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,U(1e3);case 10:return e.next=12,this.dispatchMemberLeft(t);case 12:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(W),G=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(y.a)(this,n),(e=t.apply(this,arguments)).isAdmin=!1,e}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.broadcast(r.DISPATCH,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stagingState=this.network.applyReducer(t,n),e.next=3,Promise.resolve(this.stagingState);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.leaving||t.recover().catch(K.error)}))}},{key:"recover",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=this.network.getNetworkName())){e.next=17;break}return e.prev=2,n=this.network.myId,K.debug("oldId",n),e.next=7,this.network.initAsStarHost(t,this.peerFactory);case 7:if(K.info("became the new host, changed peerId, notify others"),void 0===n){e.next=11;break}return e.next=11,this.dispatchHostLeft(n);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(2),e.next=17,this.network.reconnectToHost(t);case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"dispatchHostLeft",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.network.dispatch({type:"host-left",payload:t});case 3:e.next=11;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,U(1e3);case 9:return e.next=11,this.dispatchHostLeft(t);case 11:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(W),V=function(){function e(){Object(y.a)(this,e),this.connections={},this.sentPromises={}}return Object(j.a)(e,[{key:"reset",value:function(){this.connections={}}},{key:"registerConnection",value:function(e){this.connections[e.peer]=e}},{key:"unregisterConnection",value:function(e){var t=this.connections,n=e.peer,r=(t[n],Object(d.a)(t,[n].map(v.a)));this.connections=r}},{key:"getConnections",value:function(){return this.connections}},{key:"send",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n,r){var a,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getConn(t),e.next=3,new Promise((function(e,t){var c=Object(x.v4)();i.sentPromises[c]={resolve:function(t){return e({conn:a,data:t})},reject:function(e){return t(new Error(e))}},a.send({pkgType:n,data:r,pid:c})}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.ACK,pid:t,data:n})}},{key:"sendNACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.NACK,pid:t,data:n})}},{key:"broadcast",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=Object.keys(this.connections).map(function(){var e=Object(f.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.send(a,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"receiveACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].resolve)(t),this.removeSentPromise(e))}},{key:"receiveNACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].reject)(t),this.removeSentPromise(e))}},{key:"removeSentPromise",value:function(e){var t=this.sentPromises,n=(t[e],Object(d.a)(t,[e].map(v.a)));this.sentPromises=n}},{key:"getConn",value:function(e){if("string"===typeof e){var t=this.connections[e];if(void 0!==t)return t;throw new R(e)}return e}}]),e}(),Y=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(y.a)(this,e),this.history=[],this.historyMax=a,this.initialState=P()(t),this._reset=function(){return r.set(P()(r.initialState))},this.state=t,this._set=null!==n&&void 0!==n?n:function(e){r.state=e}}return Object(j.a)(e,[{key:"get",value:function(){return this.state}},{key:"set",value:function(e){this.state=e,this.historyMax>0&&(this.history.length>=this.historyMax&&this.history.shift(),this.history.push(P()(e))),this._set(Object(m.a)({},e))}},{key:"reset",value:function(){this._reset()}},{key:"getHistory",value:function(){return this.history}}],[{key:"make",value:function(t,n,r){return new e(t,n,r)}}]),e}(),J=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw K.error("cannot dispatch when there is staging state",this.stagingState),new I;case 3:return e.next=5,this.wrappedStrategy.dispatch(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw K.error("cannot handle dispatch request when there is staging state",this.stagingState),new I;case 3:return e.next=5,this.wrappedStrategy.handleDispatch(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(){function e(t){Object(y.a)(this,e),this.wrappedStrategy=t}return Object(j.a)(e,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.dispatch(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){return this.wrappedStrategy.forceCancel()}},{key:"handleCancel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleCancel(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleDispatch(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handlePromote",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handlePromote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isBusy",value:function(){return this.wrappedStrategy.isBusy()}},{key:"setUpConnection",value:function(e){return this.wrappedStrategy.setUpConnection(e)}},{key:"stagingState",get:function(){return this.wrappedStrategy.stagingState},set:function(e){this.wrappedStrategy.stagingState=e}},{key:"network",get:function(){return this.wrappedStrategy.network}},{key:"leaving",get:function(){return this.wrappedStrategy.leaving},set:function(e){this.wrappedStrategy.leaving=e}},{key:"isAdmin",get:function(){return this.wrappedStrategy.isAdmin},set:function(e){this.wrappedStrategy.isAdmin=e}}]),e}()),q=function(e){return new J(e)},z=function(){function e(t,n){var a=this;Object(y.a)(this,e);var i=this;this.dataStream=new V,this.getHistory=function(){return a.stateManager.getHistory()},this.kick=function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=null===(a=i.getNeighbor())||void 0===a?void 0:a.includes(t))||void 0===n||!n){e.next=5;break}return e.next=3,i.send(t,r.KICK,t);case 3:e.next=7;break;case 5:return e.next=7,i.broadcast(r.KICK,t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.stateManager=n instanceof Y?n:Y.make(n),this.stateReducer=t}return Object(j.a)(e,[{key:"getNetworkName",value:function(){return this.networkName}},{key:"setState",value:function(e){this.stateManager.set(e)}},{key:"getState",value:function(){return this.stateManager.get()}},{key:"applyReducer",value:function(e,t){return this.stateReducer(e,t)}},{key:"reduce",value:function(e){this.stateManager.set(this.stateReducer(this.stateManager.get(),e))}},{key:"leave",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=10;break}return void 0!==this.networkStrategy&&(this.networkStrategy.leaving=!0),t=new Promise((function(e){var t;return null===(t=n.peer)||void 0===t?void 0:t.on("close",e)})),this.peer.destroy(),e.next=6,t;case 6:this.peer=void 0,this.networkName=void 0,this.dataStream.reset(),this.stateManager.reset();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=2;break}throw new L;case 2:return n=null!==(r=n)&&void 0!==r?r:new D,e.prev=3,e.next=6,this.initAsStarHost(t,n);case 6:this.stateManager.reset(),this.setState(Object(m.a)(Object(m.a)({},this.getState()),{},{networkName:t})),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(3),K.info("cannot init as host, try to init as member"),e.next=15,this.initAsStarMember(t,n);case 15:return e.next=17,this.dispatch({type:"member-join"});case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarHost",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.info("initing as host"),r=this.peer,e.next=4,n.makeAndOpen(t);case 4:this.peer=e.sent,this.peer.on("connection",(function(e){K.info("received connection with",e.peer),a.setUpConnection(e)})),this.networkName=t,this.networkStrategy=q(new B(this,n)),null===r||void 0===r||r.destroy(),K.info("inited as host");case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarMember",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.info("initing as member"),this.networkStrategy=q(new G(this,n)),e.next=4,n.makeAndOpen();case 4:return this.peer=e.sent,K.info("opened peer"),e.next=8,this.reconnectToHost(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reconnectToHost",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.peer){e.next=2;break}return e.abrupt("return");case 2:return n=this.peer.connect(t),this.setUpConnection(n),e.next=6,new Promise((function(e,t){n.on("open",(function(){e()})),n.on("error",(function(e){t(e)}))}));case 6:return K.info("opened connection with host"),this.dataStream.registerConnection(n),this.networkName=t,K.info("requesting state from host"),e.next=12,this.dataStream.send(t,r.ASK_STATE,void 0);case 12:a=e.sent,void 0!==(i=a.data)&&(K.info("updating the state got from host",i),this.setState(i)),K.info("inited as member");case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNeighbor",value:function(){if(void 0!==this.peer)return Object.keys(this.dataStream.getConnections())}},{key:"send",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.send(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"broadcast",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.broadcast(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.peerId=this.myId,void 0===this.myId||null===this.myId){e.next=8;break}return K.info("dispatching action",t),e.next=5,null===(n=this.networkStrategy)||void 0===n?void 0:n.dispatch(t);case 5:K.info("dispatched action",t),e.next=9;break;case 8:K.error("not connected");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t,n=this;e.on("open",(function(){K.info("opened connection with",e.peer),n.dataStream.registerConnection(e)})),e.on("close",(function(){K.info("closed connection with",e.peer),n.dataStream.unregisterConnection(e)})),e.on("data",(function(t){return n.dataHandler(t,e)})),null===(t=this.networkStrategy)||void 0===t||t.setUpConnection(e)}},{key:"dataHandler",value:function(e,t){var n,a,i,c,o=this,s=e.pid,u=e.pkgType,l=e.data;switch(K.debug("received pkg from",t.peer,e),u){case r.DISPATCH:null===(n=this.networkStrategy)||void 0===n||n.handleDispatch(this.getState(),l).then((function(e){var n=C()(JSON.stringify(e));o.dataStream.sendACK(t,s,n)})).catch((function(e){o.dataStream.sendNACK(t,s,e.message)}));break;case r.ACK:this.dataStream.receiveACK(s,l);break;case r.NACK:this.dataStream.receiveNACK(s,l);break;case r.PROMOTE:null===(a=this.networkStrategy)||void 0===a||a.handlePromote(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.CANCEL:null===(i=this.networkStrategy)||void 0===i||i.handleCancel(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.SET_STATE:this.setState(l),null===(c=this.networkStrategy)||void 0===c||c.forceCancel();break;case r.ASK_STATE:this.dataStream.sendACK(t,s,this.state);break;case r.KICK:l===this.myId?(K.info("you got kicked out of network"),this.leave().catch(K.error)):this.send(l,u,l).catch(K.error)}}},{key:"myId",get:function(){var e;return null===(e=this.peer)||void 0===e?void 0:e.id}},{key:"connected",get:function(){return void 0!==this.networkName}},{key:"state",get:function(){return this.getState()}},{key:"isAdmin",get:function(){var e,t;return null!==(e=null===(t=this.networkStrategy)||void 0===t?void 0:t.isAdmin)&&void 0!==e&&e}}]),e}();!function(e){e.MEMBER_JOIN="member-join",e.MEMBER_LEFT="member-left",e.HOST_LEFT="host-left",e.RENAME="rename",e.READY="ready",e.START="start",e.ADD_AI="add-ai",e.ADD_LOCAL="add-local",e.REMOVE_LOCAL_AI="remove-local-ai"}(H||(H={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LOCAL=1]="LOCAL",e[e.AI=2]="AI"}(F||(F={}));var Q,X=function e(){Object(y.a)(this,e),this.minPlayer=1,this.maxPlayer=4,this.members={},this.spectators={},this.localPlayers={},this.aiPlayers={},this.nameDict={},this.players=[],this.ready={},this.started=!1},Z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reverse().reduce((function(e,t){return t(e)}),e)}},$=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}return e},ee=function(e){return function(t){if(e in t.members)throw new Error("peerId ".concat(e," already joined this room"));return(t.maxPlayer>0&&Object.values(t.members).length>=t.maxPlayer||t.started)&&(t.spectators[e]=!0),Object(m.a)(Object(m.a)({},t),{},{members:Object(m.a)(Object(m.a)({},t.members),{},Object(b.a)({},e,""))})}},te=function(e,t){return function(n){if(Object.values(n.members).includes(t))throw new Error("there is already someone named ".concat(t));if(n.started&&Object.keys(n.nameDict).includes(t)){var r=n.spectators,a=(r[e],Object(d.a)(r,[e].map(v.a)));n.spectators=a}return Object(m.a)(Object(m.a)({},n),{},{members:Object(m.a)(Object(m.a)({},n.members),{},Object(b.a)({},e,t))})}},ne=function(e,t){return function(n){var r={},a={};return Object.entries(n.localPlayers).forEach((function(n){var a=Object(h.a)(n,2),i=a[0],c=a[1];c!==e?r[i]=c:void 0!==t&&(r[i]=t)})),Object.entries(n.aiPlayers).forEach((function(n){var r=Object(h.a)(n,2),i=r[0],c=r[1];c!==e?a[i]=c:void 0!==t&&(a[i]=t)})),Object(m.a)(Object(m.a)({},n),{},{localPlayers:r,aiPlayers:a})}},re=function(e){return function(t){var n=t.members,r=(n[e],Object(d.a)(n,[e].map(v.a))),a=t.localPlayers,i=(a[e],Object(d.a)(a,[e].map(v.a))),c=t.aiPlayers,o=(c[e],Object(d.a)(c,[e].map(v.a)));return Object(m.a)(Object(m.a)({},t),{},{members:r,localPlayers:i,aiPlayers:o})}},ae=function(e){return function(t){if(t.started)throw new Error("Started already");var n=Object.keys(t.members).filter((function(t){return t!==e})).filter((function(e){return!t.spectators[e]})).filter((function(e){return void 0===t.localPlayers[e]})).filter((function(e){return void 0===t.aiPlayers[e]})).filter((function(e){var n;return void 0!==e&&!(null!==(n=t.ready[e])&&void 0!==n&&n)}));if(0===n.length)return function(e){var t=$(Object.entries(e.members).filter((function(t){var n=Object(h.a)(t,1)[0];return!e.spectators[n]})).map((function(e){return e[1]})));if(t.length>e.maxPlayer)throw new Error("Too much players, max: ".concat(e.maxPlayer,", got: ").concat(t.length));if(t.length<e.minPlayer)throw new Error("Not enough players, min: ".concat(e.minPlayer,", got: ").concat(t.length));var n={};return t.forEach((function(e,t){n[e]=t})),Object(m.a)(Object(m.a)({},e),{},{nameDict:n,players:t})}(Object(m.a)(Object(m.a)({},t),{},{started:!0}));throw new Error("".concat(n.map((function(e){return t.members[e]})).join(",")," not ready yet"))}},ie=function(e,t){var n=t.peerId;if(void 0===n)throw new Error("expect peerId in action");var r,a,i=e.networkName;if(void 0===i)throw new Error("expect networkName in prevState");switch(t.type){case H.MEMBER_JOIN:return ee(n)(e);case H.RENAME:return te(n,t.payload)(e);case H.MEMBER_LEFT:return Z(ne(t.payload,i),re(t.payload))(e);case H.HOST_LEFT:return Z(ne(t.payload,i),te(i,e.members[t.payload]),re(t.payload))(e);case H.READY:return function(e){return function(t){if(t.ready[e]){var n=t.ready,r=(n[e],Object(d.a)(n,[e].map(v.a)));return Object(m.a)(Object(m.a)({},t),{},{ready:r})}return Object(m.a)(Object(m.a)({},t),{},{ready:Object(m.a)(Object(m.a)({},t.ready),{},Object(b.a)({},e,!0))})}}(n)(e);case H.START:return ae(i)(e);case H.ADD_AI:return(r=t.payload,a=n,function(e){var t="ai-".concat(r,"-").concat(Object(x.v4)()),n=Z(te(t,r),ee(t))(e);return Object(m.a)(Object(m.a)({},n),{},{aiPlayers:Object(m.a)(Object(m.a)({},n.aiPlayers),{},Object(b.a)({},t,a))})})(e);case H.ADD_LOCAL:return function(e,t){return function(n){var r="local-".concat(e,"-").concat(Object(x.v4)()),a=Z(te(r,e),ee(r))(n);return Object(m.a)(Object(m.a)({},a),{},{localPlayers:Object(m.a)(Object(m.a)({},a.localPlayers),{},Object(b.a)({},r,t))})}}(t.payload,n)(e);case H.REMOVE_LOCAL_AI:return re(t.payload)(e);default:return e}};!function(e){e[e.HOME=0]="HOME",e[e.ROOM=1]="ROOM",e[e.GAME=2]="GAME"}(Q||(Q={}));var ce,oe,se=function(e,t){var n=Object(a.useState)(Q.HOME),r=Object(h.a)(n,2),i=r[0],c=r[1],o=function(e,t){var n=Object(a.useState)(t),r=Object(h.a)(n,2),i=r[0],c=r[1],o=Object(a.useMemo)((function(){return new z(e,Y.make(t,c,10))}),[]);return Object(a.useEffect)((function(){return void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_DISABLE_SMNET_WINDOW_VAR&&(window.stateHistory=o.getHistory,window.smnetLog=K,window.network=o),function(){o.leave().catch(K.error)}}),[o]),Object.freeze({join:o.join.bind(o),leave:o.leave.bind(o),dispatch:o.dispatch.bind(o),state:i,connected:o.connected,networkName:o.getNetworkName(),isAdmin:o.isAdmin,myId:o.myId,kick:o.kick})}(function(e){return function(t,n){return e(ie(t,n),n)}}(e),t),s=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.RENAME,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.READY});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.START});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.ADD_LOCAL,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.ADD_AI,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,K.info("connecting",n),e.next=4,o.join(n);case 4:return K.info("entering with name",t),e.next=7,s(t);case 7:K.info("connected",n),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(0),K.error(e.t0),e.next=15,m();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.info("leaving"),e.next=3,o.leave();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K.info("leaving"),!(t in o.state.aiPlayers)&&!(t in o.state.localPlayers)){e.next=6;break}return e.next=4,o.dispatch({type:H.REMOVE_LOCAL_AI,payload:t});case 4:e.next=8;break;case 6:return e.next=8,o.kick(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){o.state.started&&void 0!==o.networkName?c(Q.GAME):void 0!==o.networkName?c(Q.ROOM):c(Q.HOME)}),[o.state,o.networkName]),{connect:b,gameAppState:i,state:o.state,room:o.networkName,leave:m,isAdmin:o.isAdmin,myId:o.myId,kick:y,ready:u,start:p,dispatch:o.dispatch,addLocal:d,addAi:v,playerType:function(e){var t,n="string"===typeof e?e:o.state.players[e],r=null===(t=Object.entries(o.state.members).find((function(e){var t=Object(h.a)(e,2),r=(t[0],t[1]);return n===r})))||void 0===t?void 0:t[0];return void 0===r?F.NORMAL:r in o.state.aiPlayers?F.AI:r in o.state.localPlayers?F.LOCAL:F.NORMAL}}},ue=function(e){Object(w.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(y.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).maxPlayer=4,e.minPlayer=4,e.turn=0,e.direction=1,e.points=0,e.dead={},e.drawDeck=[],e.trashDeck=[],e.playerDeck=[],e.winner=void 0,e.logs=[],e}return n}(X);!function(e){e[e.PLAY_CARD=0]="PLAY_CARD",e[e.LOCAL_MOVE=1]="LOCAL_MOVE",e[e.END=2]="END"}(ce||(ce={})),function(e){e[e.SPADE=0]="SPADE",e[e.HEART=1]="HEART",e[e.CLUB=2]="CLUB",e[e.DIAMOND=3]="DIAMOND"}(oe||(oe={}));var le={1:1,2:2,3:3,4:0,5:0,6:6,7:7,8:8,9:9,10:10,11:0,12:20,13:99},fe=function e(t){return function(n){if(n.playerDeck[t].length>=5)throw new Error("cannot draw, ".concat(n.players[t]," already has ").concat(5," cards"));var r=n.drawDeck.shift();return void 0===r?e(t)(Object(m.a)(Object(m.a)({},n),{},{drawDeck:$(n.trashDeck),trashDeck:[]})):(n.playerDeck[t].push(r),Object(m.a)({},n))}},he=function(e){var t=(e.turn+e.maxPlayer+e.direction)%e.maxPlayer;return Object(m.a)(Object(m.a)({},e),{},{turn:t})},pe=function e(t){return!t.dead[t.turn]&&function(e,t){var n=1/0,r=0;return t.forEach((function(t,a){var i=t.suit,c=t.number,o=0;if(i===oe.SPADE&&1===c)return[0,a];(o=10===c?e-10:12===c?e-20:13===c?99:e+le[c])<n&&(n=o,r=a)})),[n,r]}(t.points,t.playerDeck[t.turn])[0]>99&&(t.logs.push("".concat(t.players[t.turn]," die, his card: ").concat(t.playerDeck[t.turn].map((function(e){return"".concat(oe[e.suit]).concat(e.number)})).join(","))),t.dead[t.turn]=!0),Object.keys(t.dead).length===t.players.length-1&&t.started&&(t.winner=[0,1,2,3].filter((function(e){return!t.dead[e]}))[0]),t.dead[t.turn]?e(he(Object(m.a)(Object(m.a)({},t),{},{turn:t.turn}))):Object(m.a)(Object(m.a)({},t),{},{turn:t.turn})},de=function e(t,n){console.log("poker99 reducer");var r=n.peerId;if(void 0===r)throw new Error("Expect peerId in action");switch(n.type){case H.START:return function(e){(e=Object(m.a)(Object(m.a)({},e),{},{drawDeck:[],trashDeck:[],playerDeck:[],points:0,direction:1,turn:0,dead:{},logs:["game started"],winner:void 0})).drawDeck=$(function(){for(var e=[],t=0;t<4;t++)for(var n=1;n<=13;n++)e.push({suit:t,number:n});return e}());for(var t=0;t<e.players.length;t++){e.playerDeck[t]=[];for(var n=0;n<5;n++)e=fe(t)(e)}return Object(m.a)({},e)}(t);case ce.PLAY_CARD:return function(e,t){return function(n){var r=t.card,a="".concat(oe[r.suit]).concat(r.number);if(void 0===n.playerDeck[e].find((function(e){var t=e.suit,n=e.number;return t===r.suit&&n===r.number})))throw new Error("".concat(n.players[e]," doesnt own card ").concat(a));if(n.turn!==e)throw new Error("not your turn");var i=1,c=le[r.number];if(10===r.number||12===r.number){if(void 0===t.increase)throw new Error("card with number 10 or 12 require increase in payload");i=t.increase?1:-1}else 13===r.number?c=99-n.points:1===r.number&&r.suit===oe.SPADE&&(i=-1,c=n.points-1);if(n.points+=i*c,n.points>99)throw new Error("playing this card will exceed 99");if(n.playerDeck[e]=n.playerDeck[e].filter((function(e){var t=e.suit,n=e.number;return!(t===r.suit&&n===r.number)})),n.trashDeck.push(r),n=fe(e)(n),5===r.number){if(void 0===t.target)throw new Error("Card with number 5 require target in payload");if(t.target===e)throw new Error("Target cannot be myself");if(n.dead[t.target])throw new Error("cannot target on dead body");return n.logs.push("".concat(n.players[n.turn]," played ").concat(a,", targeted ").concat(n.players[t.target])),n.turn=t.target,pe(n)}return 4===r.number?(n.direction*=-1,n.logs.push("".concat(n.players[n.turn]," played ").concat(a,", direction reversed"))):n.logs.push("".concat(n.players[n.turn]," played ").concat(a,", add ").concat(i*c,", now ").concat(n.points," points")),pe(he(n))}}(function(){var e=t.nameDict[t.members[r]];if(void 0===e)throw new Error("game not started");return e}(),n.payload)(P()(t));case ce.LOCAL_MOVE:return e(t,n.payload);case ce.END:return Object(m.a)(Object(m.a)({},t),{},{started:!1})}return t},ve=Object(a.createContext)(null),be=function(){var e=Object(a.useContext)(ve);if(null===e)throw new Error("please wrap it using withPoker99Network before calling this hook");return e},me=function(){var e=be().connect,t=Object(a.useState)(Object(p.a)().substring(0,4)),n=Object(h.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)("my-room"),s=Object(h.a)(o,2),u=s[0],d=s[1],v=Object(a.useState)(""),b=Object(h.a)(v,2),m=b[0],y=b[1];return i.a.createElement("div",null,i.a.createElement("h1",null,"Demo Game - Poker 99"),""!==m&&i.a.createElement("div",null,m),i.a.createElement("div",null,i.a.createElement("label",null,"your name: ",i.a.createElement("input",{value:r,onChange:function(e){var t=e.target.value;return c(t)}}))),i.a.createElement("div",null,i.a.createElement("label",null,"room code: ",i.a.createElement("input",{value:u,onChange:function(e){var t=e.target.value;return d(t)}}))),i.a.createElement("button",{disabled:""===r||""===u,onClick:Object(f.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(r,u).catch((function(e){return y(e.message)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))},"join"))},ye=function(){var e,t=be(),n=t.room,r=t.state,c=t.leave,o=t.isAdmin,s=t.myId,u=t.kick,p=t.ready,d=t.start,v=t.addAi,m=t.addLocal,y=t.playerType,O=Object(a.useState)(""),w=Object(h.a)(O,2),g=w[0],k=w[1],j=Object(a.useState)(""),E=Object(h.a)(j,2),S=E[0],A=E[1],C=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().catch((function(e){return k(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().catch((function(e){return k(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(""),e.next=3,m(S).catch((function(e){return k(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(""),e.next=3,v(S).catch((function(e){return k(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=(e={},Object(b.a)(e,F.NORMAL,""),Object(b.a)(e,F.LOCAL,"(local)"),Object(b.a)(e,F.AI,"(ai)"),e);return i.a.createElement("div",null,i.a.createElement("div",null,"Room: ",n),i.a.createElement("div",null,Object.entries(r.members).map((function(e){var t,n=Object(h.a)(e,2),a=n[0],c=n[1];return i.a.createElement("div",{key:c},c," ",T[y(c)],a!==s&&o&&i.a.createElement("button",{onClick:Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"kick"),null!==(t=r.ready[a])&&void 0!==t&&t&&"(ready)")}))),i.a.createElement("div",null,i.a.createElement("button",{onClick:c},"leave"),o?i.a.createElement("button",{onClick:C},"start"):i.a.createElement("button",{onClick:x},"ready")),i.a.createElement("div",null,i.a.createElement("input",{placeholder:"new local/ai player name",value:S,onChange:function(e){var t=e.target.value;return A(t)}}),i.a.createElement("button",{onClick:_},"Add local"),i.a.createElement("button",{onClick:P},"Add AI")),""!==g&&i.a.createElement("div",null,g))},Oe=n(44),we=function(e){return(e.suit!==oe.SPADE||1!==e.number)&&[1,2,3,6,7,8,9].includes(e.number)},ge=function(e){return[10,12].includes(e.number)},ke=function(e){return[4,5,11,13].includes(e.number)},je=function(){var e=be(),t=e.state,n=e.myId,r=e.dispatch,c=Object(a.useState)(0),o=Object(h.a)(c,2),s=o[0],u=o[1],p=Object(a.useState)(!0),d=Object(h.a)(p,2),v=d[0],b=d[1],m=Object(a.useState)(""),y=Object(h.a)(m,2),O=y[0],w=y[1],g=Object(a.useMemo)((function(){try{return t.nameDict[t.members[n]]}catch(e){return 0}}),[n,t]),k=Object(a.useMemo)((function(){try{return Object.keys(t.localPlayers).filter((function(e){return t.localPlayers[e]===n})).map((function(e){return t.members[e]}))}catch(e){return[]}}),[n,t]),j=Object(a.useMemo)((function(){try{return Object.keys(t.aiPlayers).filter((function(e){return t.aiPlayers[e]===n})).map((function(e){return t.members[e]}))}catch(e){return[]}}),[n,t]),E=Object(a.useState)(k.length>0),S=Object(h.a)(E,2),A=S[0],C=S[1],x=Object(a.useState)(g),_=Object(h.a)(x,2),P=_[0],T=_[1],D=Object(a.useRef)(-1);t.turn!==D.current&&(k.length>0&&(A=!0,C(!0),T(t.turn)),D.current=t.turn);var L=function(e){w(e.message)};Object(a.useEffect)((function(){if(j.includes(t.players[t.turn])&&t.started&&void 0===t.winner){var e=window.setTimeout((function(){var e=function(e,t){var n=e.playerDeck[t],r=e.points,a=n.filter(we).sort((function(e,t){return le[t.number]-le[e.number]}));console.log("normal cards",a,"points",r);var i=n.find((function(e){return 13===e.number}));if(void 0!==i&&99!==r&&a.length<3)return{type:ce.PLAY_CARD,payload:{card:i}};var c,o=Object(Oe.a)(a);try{for(o.s();!(c=o.n()).done;){var s=c.value;if(console.log("should play normal?",s,r+le[s.number]<=99),r+le[s.number]<=99)return{type:ce.PLAY_CARD,payload:{card:s}}}}catch(w){o.e(w)}finally{o.f()}var u,l=n.filter(ge),f=Object(Oe.a)(l.sort((function(e,t){return t.number-e.number})));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(r+le[h.number]<=99)return{type:ce.PLAY_CARD,payload:{card:h,increase:!0}}}}catch(w){f.e(w)}finally{f.f()}var p=n.find(ke);if(void 0!==p)return{type:ce.PLAY_CARD,payload:{card:p,target:e.nameDict[$(e.players.filter((function(n,r){return!e.dead[r]&&r!==t})))[0]]}};var d,v=Object(Oe.a)(l.sort((function(e,t){return e.number-t.number})));try{for(v.s();!(d=v.n()).done;){var b=d.value;if(r-le[b.number]<=99)return{type:ce.PLAY_CARD,payload:{card:b,increase:!1}}}}catch(w){v.e(w)}finally{v.f()}var m,y=Object(Oe.a)(n);try{for(y.s();!(m=y.n()).done;){var O=m.value;if(r-le[O.number]<=99)return{type:ce.PLAY_CARD,payload:{card:O,increase:!1}}}}catch(w){y.e(w)}finally{y.f()}throw new Error("reached an edge case")}(t,t.turn);e.peerId=Object.keys(t.members).filter((function(e){return t.members[e]===t.players[t.turn]}))[0],r({type:ce.LOCAL_MOVE,payload:e}).catch(L)}),500);return function(){window.clearTimeout(e)}}}),[t]);var R=1===t.direction?">":"<",N=function(e){return Object(f.a)(l.a.mark((function n(){var a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={type:ce.PLAY_CARD,payload:{card:e,increase:v,target:s}},t.turn!==g){n.next=6;break}return n.next=4,r(a).then((function(){return w("")})).catch(L);case 4:n.next=10;break;case 6:if(!k.includes(t.players[t.turn])){n.next=10;break}return a.peerId=Object.keys(t.members).filter((function(e){return t.members[e]===t.players[t.turn]}))[0],n.next=10,r({type:ce.LOCAL_MOVE,payload:a}).then((function(){return w("")})).catch(L);case 10:case"end":return n.stop()}}),n)})))},I=function(e){var n;return null===(n=t.playerDeck[e])||void 0===n?void 0:n.map((function(e){return i.a.createElement("button",{key:10*e.number+e.suit,onClick:N(e)},oe[e.suit]," ",e.number)}))},M=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({type:ce.END}).catch(L);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("h3",null,t.points),i.a.createElement("h6",null,t.players[t.turn],"'","s turn"),""!==O&&i.a.createElement("div",{style:{color:"red"}},O),void 0!==t.winner&&i.a.createElement("div",null,"winner is ",t.players[t.winner],i.a.createElement("button",{onClick:M},"again")),t.players.map((function(e,n){return i.a.createElement("span",{key:e,onClick:function(){return u(n)},style:{fontWeight:t.turn===n?"bold":"normal",textDecorationLine:t.dead[n]?"line-through":"none"}},e," ",R)})),i.a.createElement("div",null,0===k.length?I(g):A?i.a.createElement("button",{onClick:function(){return C(!1)}},"show ",t.players[P]):I(P)),i.a.createElement("div",null,"target: ",s),i.a.createElement("button",{onClick:function(){return b(!v)}},v?"+":"-")),i.a.createElement("div",null,t.logs.slice().reverse().map((function(e,t){return i.a.createElement("div",{key:t},e)}))))},Ee=function(e){var t=function(t){var n=se(de,new ue);return i.a.createElement(ve.Provider,{value:n},i.a.createElement(e,t))};return t.displayName="WithGameNetwork",t}((function(){switch(be().gameAppState){case Q.HOME:return i.a.createElement(me,null);case Q.ROOM:return i.a.createElement(ye,null);case Q.GAME:return i.a.createElement(je,null);default:throw new Error("unknown state")}}));o.a.render(i.a.createElement(Ee,null),document.getElementById("root")),s()}},[[133,1,2]]]);
//# sourceMappingURL=main.dc7523fe.chunk.js.map