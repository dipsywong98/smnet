(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{133:function(e,t,n){e.exports=n(240)},138:function(e,t,n){},140:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=140},145:function(e,t){},147:function(e,t){},157:function(e,t){},159:function(e,t){},186:function(e,t){},187:function(e,t){},192:function(e,t){},194:function(e,t){},218:function(e,t){},240:function(e,t,n){"use strict";n.r(t);var r,a=n(1),c=n.n(a),i=n(131),o=n.n(i),s=(n(138),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,243)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))}),u=n(0),l=n.n(u),f=n(3),h=n(6),p=n(242),d=n(15),v=n(16),m=n(19),b=n(20),y=n(7),O=n(2),w=n(8),k=n(35),g=n(46),j=n(17),E=n(132),A=n.n(E),S=n(44),x=n.n(S),C=n(43),P=n(34),L=n.n(P);!function(e){e.DISPATCH="DISPATCH",e.ACK="ACK",e.NACK="NACK",e.PROMOTE="PROMOTE",e.CANCEL="CANCEL",e.SET_STATE="SET_STATE",e.ASK_STATE="ASK_STATE",e.KICK="KICK"}(r||(r={}));var D,_=function(){function e(t){if(Object(w.a)(this,e),void 0!==t)this._options=t;else{var n='{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}';this._options={host:null!=="peer.hkustracing.com"?"peer.hkustracing.com":"localhost",port:Number.parseInt(null!=="443"?"443":"9000",10),path:null!=="/"?"/":"/peer",secure:!0,config:JSON.parse(n)}}}return Object(j.a)(e,[{key:"make",value:function(e){return new A.a(e,this._options)}},{key:"makeAndOpen",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.make(t),e.next=3,new Promise((function(e,t){n.on("open",(function(){e(n)})),n.on("error",(function(){t(n)}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),R=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="already joined network",e.name="AlreadyJoinedNetworkError",e}return n}(Object(g.a)(Error)),N=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(w.a)(this,n),(r=t.call(this)).name="PlayerNameAlreadyExistError",r.message="not connected to ".concat(e),r}return n}(Object(g.a)(Error)),T=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="No Staging State",e.name="NoStagingStateError",e}return n}(Object(g.a)(Error)),I=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="Network is busy, please retry later",e.name="NetworkBusyError",e}return n}(Object(g.a)(Error));!function(e){e[e.ALL=0]="ALL",e[e.TRACE=1]="TRACE",e[e.LOG=2]="LOG",e[e.DEBUG=3]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=5]="WARN",e[e.ERROR=6]="ERROR",e[e.OFF=7]="OFF"}(D||(D={}));var M=function(){function e(t,n,r){var a=this;Object(w.a)(this,e),this._logs=[],this.pushLog=function(e,t){a._logs.length>=a._keep&&a._logs.shift();for(var n=arguments.length,r=new Array(n>2?n-2:0),c=2;c<n;c++)r[c-2]=arguments[c];a._logs.push({level:e,message:r,date:new Date})},this.getLogFunction=function(e){if(e<a._verboseLevel)return function(){};switch(e){case D.INFO:return console.info.bind(window.console);case D.LOG:case D.DEBUG:return console.log.bind(window.console);case D.ERROR:return console.error.bind(window.console);case D.WARN:return console.warn.bind(window.console);case D.TRACE:return console.trace.bind(window.console);default:return function(){}}},this.withColor=function(e,t){return function(n){var r,a=(r={},Object(y.a)(r,D.INFO,"color: DodgerBlue"),Object(y.a)(r,D.LOG,""),Object(y.a)(r,D.DEBUG,"color: Green"),Object(y.a)(r,D.ERROR,""),Object(y.a)(r,D.WARN,""),Object(y.a)(r,D.TRACE,"color: Green"),Object(y.a)(r,D.ALL,""),Object(y.a)(r,D.OFF,""),r)[e],c=void 0===t?"%c[".concat(D[e],"]"):"%c[".concat(t.toISOString()," ").concat(D[e],"]");return Function.prototype.bind.call(n,console,c,a)}},this.withHistoryButWrongLineNumber=function(e){return function(t){return new Proxy(t,{apply:function(t,n,r){var c=new Date;return a.pushLog.apply(a,[e,c].concat(Object(k.a)(r))),t.apply(void 0,Object(k.a)(r))}})}},this.withAllFeatures=function(e){return e>=a._historyLevel?a.withHistoryButWrongLineNumber(e)(a.withColor(e)(a.getLogFunction(e))):a.withColor(e)(a.getLogFunction(e))},this.clear=function(){a._logs.splice(0,a._logs.length)},this.printLogs=function(){a._logs.forEach((function(e){var t=e.level,n=e.message,r=e.date;a.withColor(t,r)(a.getLogFunction(t)).apply(void 0,Object(k.a)(n))}))},this.getLogs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.ALL;return a._logs.filter((function(t){return t.level>=e}))},this._historyLevel=t,this._verboseLevel=n,this._keep=r}return Object(j.a)(e,[{key:"historyLevel",set:function(e){this._historyLevel=e}},{key:"verboseLevel",set:function(e){this._verboseLevel=e}},{key:"keep",set:function(e){this._keep=e}},{key:"info",get:function(){return this.withAllFeatures(D.INFO)}},{key:"log",get:function(){return this.withAllFeatures(D.LOG)}},{key:"debug",get:function(){return this.withAllFeatures(D.DEBUG)}},{key:"error",get:function(){return this.withAllFeatures(D.ERROR)}},{key:"warn",get:function(){return this.withAllFeatures(D.WARN)}},{key:"trace",get:function(){return this.withAllFeatures(D.TRACE)}}]),e}(),H=new M(D.ALL,D.WARN,100);H.historyLevel=D.OFF,H.verboseLevel=D.ALL;var K,F,B=function(){function e(t,n){Object(w.a)(this,e),this.isAdmin=!0,this.leaving=!1,this.network=t,this.peerFactory=n}return Object(j.a)(e,[{key:"handlePromote",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=12;break}if((n=x()(JSON.stringify(this.stagingState)))!==t){e.next=8;break}this.network.setState(this.stagingState),H.info("promoted the stagingState",this.stagingState),this.stagingState=void 0,e.next=10;break;case 8:throw H.error("Cannot promote, staging checksum is ".concat(n," while requested to promote checksum of ").concat(t)),new Error("Cannot promote staging state with unmatched checksum");case 10:e.next=14;break;case 12:throw H.error("Cannot promote, there is no staging state"),new T;case 14:return e.next=16,Promise.resolve();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleCancel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=11;break}if((n=x()(JSON.stringify(this.stagingState)))!==t){e.next=7;break}H.info("canceled the stagingState",this.stagingState),this.stagingState=void 0,e.next=9;break;case 7:throw H.error("Cannot cancel, staging checksum is ".concat(n," while requested to cancel checksum of ").concat(t)),new Error("Cannot cancel staging state with unmatched checksum");case 9:e.next=13;break;case 11:throw H.error("Cannot cancel, there is no staging state"),new T;case 13:return e.next=15,Promise.resolve();case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){H.info("force cancel the stagingState"),this.stagingState=void 0}},{key:"isBusy",value:function(){return void 0!==this.stagingState}}]),e}(),U=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout((function(){e()}),t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(w.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a,c,i,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,H.debug("reduce locally",this.network.getState(),t),this.stagingState=this.network.applyReducer(this.network.getState(),t),a=x()(JSON.stringify(this.stagingState)),H.debug("stagingState",this.stagingState),e.next=7,this.network.broadcast(r.DISPATCH,t);case 7:if(c=e.sent,H.debug("obtained responses",c),i=[],o=[],s=[],c.forEach((function(e){var t=e.conn,n=e.data,r=e.error;void 0!==r?i.push({error:r,conn:t}):n!==a?o.push(t):s.push(t)})),s.length===c.length?H.debug("all can be promoted"):(i.length>0&&H.error("received ".concat(i.length," error from some peers"),i),o.length>0&&H.warn("received ".concat(o.length," unmatched checksum from some peer, forceUpdating them"),o)),!(i.length>0)){e.next=20;break}return e.next=17,this.network.broadcast(r.CANCEL,a);case 17:throw new Error(i[0].error);case 20:o.map(function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.SET_STATE,n.stagingState);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.map(function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.PROMOTE,a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 22:return e.next=24,this.handlePromote(a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch(n);case 2:return e.abrupt("return",this.network.getState());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.dispatchMemberLeft(e.peer).catch(H.error)}))}},{key:"dispatchMemberLeft",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.leaving){e.next=12;break}return e.prev=1,e.next=4,this.network.dispatch({type:"member-left",payload:t});case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,U(1e3);case 10:return e.next=12,this.dispatchMemberLeft(t);case 12:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(B),W=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).isAdmin=!1,e}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.broadcast(r.DISPATCH,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stagingState=this.network.applyReducer(t,n),e.next=3,Promise.resolve(this.stagingState);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.leaving||t.recover().catch(H.error)}))}},{key:"recover",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=this.network.getNetworkName())){e.next=17;break}return e.prev=2,n=this.network.myId,H.debug("oldId",n),e.next=7,this.network.initAsStarHost(t,this.peerFactory);case 7:if(H.info("became the new host, changed peerId, notify others"),void 0===n){e.next=11;break}return e.next=11,this.dispatchHostLeft(n);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(2),e.next=17,this.network.reconnectToHost(t);case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"dispatchHostLeft",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.network.dispatch({type:"host-left",payload:t});case 3:e.next=11;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,U(1e3);case 9:return e.next=11,this.dispatchHostLeft(t);case 11:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(B),Y=function(){function e(){Object(w.a)(this,e),this.connections={},this.sentPromises={}}return Object(j.a)(e,[{key:"reset",value:function(){this.connections={}}},{key:"registerConnection",value:function(e){this.connections[e.peer]=e}},{key:"unregisterConnection",value:function(e){var t=this.connections,n=e.peer,r=(t[n],Object(m.a)(t,[n].map(b.a)));this.connections=r}},{key:"getConnections",value:function(){return this.connections}},{key:"send",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n,r){var a,c=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getConn(t),e.next=3,new Promise((function(e,t){var i=Object(C.v4)();c.sentPromises[i]={resolve:function(t){return e({conn:a,data:t})},reject:function(e){return t(new Error(e))}},a.send({pkgType:n,data:r,pid:i})}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.ACK,pid:t,data:n})}},{key:"sendNACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.NACK,pid:t,data:n})}},{key:"broadcast",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=Object.keys(this.connections).map(function(){var e=Object(f.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.send(a,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"receiveACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].resolve)(t),this.removeSentPromise(e))}},{key:"receiveNACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].reject)(t),this.removeSentPromise(e))}},{key:"removeSentPromise",value:function(e){var t=this.sentPromises,n=(t[e],Object(m.a)(t,[e].map(b.a)));this.sentPromises=n}},{key:"getConn",value:function(e){if("string"===typeof e){var t=this.connections[e];if(void 0!==t)return t;throw new N(e)}return e}}]),e}(),J=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(w.a)(this,e),this.history=[],this.historyMax=a,this.initialState=L()(t),this._reset=function(){return r.set(L()(r.initialState))},this.state=t,this._set=null!==n&&void 0!==n?n:function(e){r.state=e}}return Object(j.a)(e,[{key:"get",value:function(){return this.state}},{key:"set",value:function(e){this.state=e,this.historyMax>0&&(this.history.length>=this.historyMax&&this.history.shift(),this.history.push(L()(e))),this._set(Object(O.a)({},e))}},{key:"reset",value:function(){this._reset()}},{key:"getHistory",value:function(){return this.history}}],[{key:"make",value:function(t,n,r){return new e(t,n,r)}}]),e}(),V=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(w.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw H.error("cannot dispatch when there is staging state",this.stagingState),new I;case 3:return e.next=5,this.wrappedStrategy.dispatch(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw H.error("cannot handle dispatch request when there is staging state",this.stagingState),new I;case 3:return e.next=5,this.wrappedStrategy.handleDispatch(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(){function e(t){Object(w.a)(this,e),this.wrappedStrategy=t}return Object(j.a)(e,[{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.dispatch(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){return this.wrappedStrategy.forceCancel()}},{key:"handleCancel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleCancel(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleDispatch(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handlePromote",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handlePromote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isBusy",value:function(){return this.wrappedStrategy.isBusy()}},{key:"setUpConnection",value:function(e){return this.wrappedStrategy.setUpConnection(e)}},{key:"stagingState",get:function(){return this.wrappedStrategy.stagingState},set:function(e){this.wrappedStrategy.stagingState=e}},{key:"network",get:function(){return this.wrappedStrategy.network}},{key:"leaving",get:function(){return this.wrappedStrategy.leaving},set:function(e){this.wrappedStrategy.leaving=e}},{key:"isAdmin",get:function(){return this.wrappedStrategy.isAdmin},set:function(e){this.wrappedStrategy.isAdmin=e}}]),e}()),q=function(e){return new V(e)},z=function(){function e(t,n){var a=this;Object(w.a)(this,e);var c=this;this.dataStream=new Y,this.getHistory=function(){return a.stateManager.getHistory()},this.kick=function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=null===(a=c.getNeighbor())||void 0===a?void 0:a.includes(t))||void 0===n||!n){e.next=5;break}return e.next=3,c.send(t,r.KICK,t);case 3:e.next=7;break;case 5:return e.next=7,c.broadcast(r.KICK,t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.stateManager=n instanceof J?n:J.make(n),this.stateReducer=t}return Object(j.a)(e,[{key:"getNetworkName",value:function(){return this.networkName}},{key:"setState",value:function(e){this.stateManager.set(e)}},{key:"getState",value:function(){return this.stateManager.get()}},{key:"applyReducer",value:function(e,t){return this.stateReducer(e,t)}},{key:"reduce",value:function(e){this.stateManager.set(this.stateReducer(this.stateManager.get(),e))}},{key:"leave",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=10;break}return void 0!==this.networkStrategy&&(this.networkStrategy.leaving=!0),t=new Promise((function(e){var t;return null===(t=n.peer)||void 0===t?void 0:t.on("close",e)})),this.peer.destroy(),e.next=6,t;case 6:this.peer=void 0,this.networkName=void 0,this.dataStream.reset(),this.stateManager.reset();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=2;break}throw new R;case 2:return n=null!==(r=n)&&void 0!==r?r:new _,e.prev=3,e.next=6,this.initAsStarHost(t,n);case 6:this.stateManager.reset(),this.setState(Object(O.a)(Object(O.a)({},this.getState()),{},{networkName:t})),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(3),H.info("cannot init as host, try to init as member"),e.next=15,this.initAsStarMember(t,n);case 15:return e.next=17,this.dispatch({type:"member-join"});case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarHost",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.info("initing as host"),r=this.peer,e.next=4,n.makeAndOpen(t);case 4:this.peer=e.sent,this.peer.on("connection",(function(e){H.info("received connection with",e.peer),a.setUpConnection(e)})),this.networkName=t,this.networkStrategy=q(new G(this,n)),null===r||void 0===r||r.destroy(),H.info("inited as host");case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarMember",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.info("initing as member"),this.networkStrategy=q(new W(this,n)),e.next=4,n.makeAndOpen();case 4:return this.peer=e.sent,H.info("opened peer"),e.next=8,this.reconnectToHost(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reconnectToHost",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.peer){e.next=2;break}return e.abrupt("return");case 2:return n=this.peer.connect(t),this.setUpConnection(n),e.next=6,new Promise((function(e,t){n.on("open",(function(){e()})),n.on("error",(function(e){t(e)}))}));case 6:return H.info("opened connection with host"),this.dataStream.registerConnection(n),this.networkName=t,H.info("requesting state from host"),e.next=12,this.dataStream.send(t,r.ASK_STATE,void 0);case 12:a=e.sent,void 0!==(c=a.data)&&(H.info("updating the state got from host",c),this.setState(c)),H.info("inited as member");case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNeighbor",value:function(){if(void 0!==this.peer)return Object.keys(this.dataStream.getConnections())}},{key:"send",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.send(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"broadcast",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.broadcast(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"dispatch",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.peerId=null!==(n=t.peerId)&&void 0!==n?n:this.myId,void 0===this.myId||null===this.myId){e.next=8;break}return H.info("dispatching action",t),e.next=5,null===(r=this.networkStrategy)||void 0===r?void 0:r.dispatch(t);case 5:H.info("dispatched action",t),e.next=9;break;case 8:H.error("not connected");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t,n=this;e.on("open",(function(){H.info("opened connection with",e.peer),n.dataStream.registerConnection(e)})),e.on("close",(function(){H.info("closed connection with",e.peer),n.dataStream.unregisterConnection(e)})),e.on("data",(function(t){return n.dataHandler(t,e)})),null===(t=this.networkStrategy)||void 0===t||t.setUpConnection(e)}},{key:"dataHandler",value:function(e,t){var n,a,c,i,o=this,s=e.pid,u=e.pkgType,l=e.data;switch(H.debug("received pkg from",t.peer,e),u){case r.DISPATCH:null===(n=this.networkStrategy)||void 0===n||n.handleDispatch(this.getState(),l).then((function(e){var n=x()(JSON.stringify(e));o.dataStream.sendACK(t,s,n)})).catch((function(e){o.dataStream.sendNACK(t,s,e.message)}));break;case r.ACK:this.dataStream.receiveACK(s,l);break;case r.NACK:this.dataStream.receiveNACK(s,l);break;case r.PROMOTE:null===(a=this.networkStrategy)||void 0===a||a.handlePromote(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.CANCEL:null===(c=this.networkStrategy)||void 0===c||c.handleCancel(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.SET_STATE:this.setState(l),null===(i=this.networkStrategy)||void 0===i||i.forceCancel();break;case r.ASK_STATE:this.dataStream.sendACK(t,s,this.state);break;case r.KICK:l===this.myId?(H.info("you got kicked out of network"),this.leave().catch(H.error)):this.send(l,u,l).catch(H.error)}}},{key:"myId",get:function(){var e;return null===(e=this.peer)||void 0===e?void 0:e.id}},{key:"connected",get:function(){return void 0!==this.networkName}},{key:"state",get:function(){return this.getState()}},{key:"isAdmin",get:function(){var e,t;return null!==(e=null===(t=this.networkStrategy)||void 0===t?void 0:t.isAdmin)&&void 0!==e&&e}}]),e}();!function(e){e.MEMBER_JOIN="member-join",e.MEMBER_LEFT="member-left",e.HOST_LEFT="host-left",e.RENAME="rename",e.READY="ready",e.START="start",e.ADD_AI="add-ai",e.ADD_LOCAL="add-local",e.REMOVE_LOCAL_AI="remove-local-ai"}(K||(K={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LOCAL=1]="LOCAL",e[e.AI=2]="AI"}(F||(F={}));var Q,X=function e(){Object(w.a)(this,e),this.minPlayer=1,this.maxPlayer=4,this.members={},this.spectators={},this.localPlayers={},this.aiPlayers={},this.nameDict={},this.players=[],this.ready={},this.started=!1},Z=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reverse().reduce((function(e,t){return t(e)}),e)}},$=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}return e},ee=function(e){return function(t){if(e in t.members)throw new Error("peerId ".concat(e," already joined this room"));return(t.maxPlayer>0&&Object.values(t.members).length>=t.maxPlayer||t.started)&&(t.spectators[e]=!0),Object(O.a)(Object(O.a)({},t),{},{members:Object(O.a)(Object(O.a)({},t.members),{},Object(y.a)({},e,""))})}},te=function(e,t){return function(n){if(Object.values(n.members).includes(t))throw new Error("there is already someone named ".concat(t));if(n.started&&Object.keys(n.nameDict).includes(t)){var r=n.spectators,a=(r[e],Object(m.a)(r,[e].map(b.a)));n.spectators=a}return Object(O.a)(Object(O.a)({},n),{},{members:Object(O.a)(Object(O.a)({},n.members),{},Object(y.a)({},e,t))})}},ne=function(e,t){return function(n){var r={},a={};return Object.entries(n.localPlayers).forEach((function(n){var a=Object(h.a)(n,2),c=a[0],i=a[1];i!==e?r[c]=i:void 0!==t&&(r[c]=t)})),Object.entries(n.aiPlayers).forEach((function(n){var r=Object(h.a)(n,2),c=r[0],i=r[1];i!==e?a[c]=i:void 0!==t&&(a[c]=t)})),Object(O.a)(Object(O.a)({},n),{},{localPlayers:r,aiPlayers:a})}},re=function(e){return function(t){var n=t.members,r=(n[e],Object(m.a)(n,[e].map(b.a))),a=t.localPlayers,c=(a[e],Object(m.a)(a,[e].map(b.a))),i=t.aiPlayers,o=(i[e],Object(m.a)(i,[e].map(b.a)));return Object(O.a)(Object(O.a)({},t),{},{members:r,localPlayers:c,aiPlayers:o})}},ae=function(e){return function(t){if(t.started)throw new Error("Started already");var n=Object.keys(t.members).filter((function(t){return t!==e})).filter((function(e){return!t.spectators[e]})).filter((function(e){return void 0===t.localPlayers[e]})).filter((function(e){return void 0===t.aiPlayers[e]})).filter((function(e){var n;return void 0!==e&&!(null!==(n=t.ready[e])&&void 0!==n&&n)}));if(0===n.length)return function(e){var t=$(Object.entries(e.members).filter((function(t){var n=Object(h.a)(t,1)[0];return!e.spectators[n]})).map((function(e){return e[1]})));if(t.length>e.maxPlayer)throw new Error("Too much players, max: ".concat(e.maxPlayer,", got: ").concat(t.length));if(t.length<e.minPlayer)throw new Error("Not enough players, min: ".concat(e.minPlayer,", got: ").concat(t.length));var n={};return t.forEach((function(e,t){n[e]=t})),Object(O.a)(Object(O.a)({},e),{},{nameDict:n,players:t})}(Object(O.a)(Object(O.a)({},t),{},{started:!0}));throw new Error("".concat(n.map((function(e){return t.members[e]})).join(",")," not ready yet"))}},ce=function(e,t){var n=t.peerId;if(void 0===n)throw new Error("expect peerId in action");var r,a,c=e.networkName;if(void 0===c)throw new Error("expect networkName in prevState");switch(t.type){case K.MEMBER_JOIN:return ee(n)(e);case K.RENAME:return te(n,t.payload)(e);case K.MEMBER_LEFT:return Z(ne(t.payload,c),re(t.payload))(e);case K.HOST_LEFT:return Z(ne(t.payload,c),te(c,e.members[t.payload]),re(t.payload))(e);case K.READY:return function(e){return function(t){if(t.ready[e]){var n=t.ready,r=(n[e],Object(m.a)(n,[e].map(b.a)));return Object(O.a)(Object(O.a)({},t),{},{ready:r})}return Object(O.a)(Object(O.a)({},t),{},{ready:Object(O.a)(Object(O.a)({},t.ready),{},Object(y.a)({},e,!0))})}}(n)(e);case K.START:return ae(c)(e);case K.ADD_AI:return(r=t.payload,a=n,function(e){var t="ai-".concat(r,"-").concat(Object(C.v4)()),n=Z(te(t,r),ee(t))(e);return Object(O.a)(Object(O.a)({},n),{},{aiPlayers:Object(O.a)(Object(O.a)({},n.aiPlayers),{},Object(y.a)({},t,a))})})(e);case K.ADD_LOCAL:return function(e,t){return function(n){var r="local-".concat(e,"-").concat(Object(C.v4)()),a=Z(te(r,e),ee(r))(n);return Object(O.a)(Object(O.a)({},a),{},{localPlayers:Object(O.a)(Object(O.a)({},a.localPlayers),{},Object(y.a)({},r,t))})}}(t.payload,n)(e);case K.REMOVE_LOCAL_AI:return re(t.payload)(e);default:return e}};!function(e){e[e.HOME=0]="HOME",e[e.ROOM=1]="ROOM",e[e.GAME=2]="GAME"}(Q||(Q={}));var ie,oe,se=function(e,t){var n=Object(a.useState)(Q.HOME),r=Object(h.a)(n,2),c=r[0],i=r[1],o=function(e,t){var n=Object(a.useState)(t),r=Object(h.a)(n,2),c=r[0],i=r[1],o=Object(a.useMemo)((function(){return new z(e,J.make(t,i,10))}),[]);return Object(a.useEffect)((function(){return void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_PEER_CONFIG:'{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}',REACT_APP_PEER_HOST:"peer.hkustracing.com",REACT_APP_PEER_PATH:"/",REACT_APP_PEER_PORT:"443",REACT_APP_PEER_SECURE:"true",REACT_APP_SMNET_VERBOSE_ALL_NO_HISTORY:"true"}).REACT_APP_DISABLE_SMNET_WINDOW_VAR&&(window.stateHistory=o.getHistory,window.smnetLog=H,window.network=o),function(){o.leave().catch(H.error)}}),[o]),Object.freeze({join:o.join.bind(o),leave:o.leave.bind(o),dispatch:o.dispatch.bind(o),state:c,connected:o.connected,networkName:o.getNetworkName(),isAdmin:o.isAdmin,myId:o.myId,kick:o.kick})}(function(e){return function(t,n){return e(ce(t,n),n)}}(e),t),s=o.state,u=o.myId,p=Object(a.useMemo)((function(){try{return s.nameDict[s.members[u]]}catch(e){return-1}}),[u,s]),d=Object(a.useMemo)((function(){try{return Object.keys(s.localPlayers).filter((function(e){return s.localPlayers[e]===u})).map((function(e){return s.members[e]}))}catch(e){return[]}}),[u,s]),v=Object(a.useMemo)((function(){try{return Object.keys(s.aiPlayers).filter((function(e){return s.aiPlayers[e]===u})).map((function(e){return s.members[e]}))}catch(e){return[]}}),[u,s]),m=function(e){return Object.keys(s.members).filter((function(t){return s.members[t]===s.players[e]}))[0]},b=function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch(Object(O.a)(Object(O.a)({},n),{},{peerId:m(t)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:K.RENAME,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:K.READY});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:K.START});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:K.ADD_LOCAL,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:K.ADD_AI,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,H.info("connecting",n),e.next=4,o.join(n);case 4:return H.info("entering with name",t),e.next=7,y(t);case 7:H.info("connected",n),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(0),H.error(e.t0),e.next=15,A();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.info("leaving"),e.next=3,o.leave();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.info("leaving"),!(t in o.state.aiPlayers)&&!(t in o.state.localPlayers)){e.next=6;break}return e.next=4,o.dispatch({type:K.REMOVE_LOCAL_AI,payload:t});case 4:e.next=8;break;case 6:return e.next=8,o.kick(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){o.state.started&&void 0!==o.networkName?i(Q.GAME):void 0!==o.networkName?i(Q.ROOM):i(Q.HOME)}),[o.state,o.networkName]),{connect:E,gameAppState:c,state:s,room:o.networkName,leave:A,isAdmin:o.isAdmin,myId:u,kick:S,ready:w,start:k,dispatch:o.dispatch,addLocal:g,addAi:j,playerType:function(e){var t,n="string"===typeof e?e:o.state.players[e],r=null===(t=Object.entries(o.state.members).find((function(e){var t=Object(h.a)(e,2),r=(t[0],t[1]);return n===r})))||void 0===t?void 0:t[0];return void 0===r?F.NORMAL:r in o.state.aiPlayers?F.AI:r in o.state.localPlayers?F.LOCAL:F.NORMAL},myPlayerId:p,myLocals:d,myAis:v,getPeerId:m,dispatchAs:b}},ue=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(w.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).maxPlayer=4,e.minPlayer=4,e.turn=0,e.direction=1,e.points=0,e.dead={},e.drawDeck=[],e.trashDeck=[],e.playerDeck=[],e.winner=void 0,e.logs=[],e}return n}(X);!function(e){e[e.PLAY_CARD=0]="PLAY_CARD",e[e.LOCAL_MOVE=1]="LOCAL_MOVE",e[e.END=2]="END"}(ie||(ie={})),function(e){e[e.SPADE=0]="SPADE",e[e.HEART=1]="HEART",e[e.CLUB=2]="CLUB",e[e.DIAMOND=3]="DIAMOND"}(oe||(oe={}));var le={1:1,2:2,3:3,4:0,5:0,6:6,7:7,8:8,9:9,10:10,11:0,12:20,13:99},fe=function(e){var t=e.card;return function(e){return function(e){return 13===e.number}(t)?(e.points=99,je(ge(e))):e}},he=function(e){return(e.suit!==oe.SPADE||1!==e.number)&&[1,2,3,6,7,8,9].includes(e.number)},pe=function(e){var t=e.card;return function(e){if(he(t)){var n=e.points+le[t.number];if(n>99)throw new Error("playing this card will exceed 99");return je(ge(Object(O.a)(Object(O.a)({},e),{},{points:n})))}return e}},de=function(e){return 10===e.number||12===e.number},ve=function(e){var t=e.card,n=e.increase;return function(e){if(de(t)){if(void 0===n)throw new Error("increase is required in payload");var r=e.points+(n?le[t.number]:-le[t.number]);if(r>99)throw new Error("playing this card will exceed 99");return je(ge(Object(O.a)(Object(O.a)({},e),{},{points:r})))}return e}},me=function(e){var t=e.card;return function(e){return function(e){return 4===e.number}(t)?(e.direction*=-1,je(ge(e))):e}},be=function(e){var t=e.card;return function(e){return function(e){return 11===e.number}(t)?je(ge(e)):e}},ye=function(e,t){var n=e.card,r=e.target;return function(e){if(function(e){return 5===e.number}(n)){if(void 0===r)throw new Error("target is required in payload");if(r===t)throw new Error("cannot target myself");return e.turn=r,je(e)}return e}},Oe=function(e){var t=e.card;return function(e){return function(e){return 1===e.number&&e.suit===oe.SPADE}(t)?(e.points=1,je(ge(e))):e}},we=function e(t){return function(n){if(n.playerDeck[t].length>=5)throw new Error("cannot draw, ".concat(n.players[t]," already has ").concat(5," cards"));var r=n.drawDeck.shift();return void 0===r?e(t)(Object(O.a)(Object(O.a)({},n),{},{drawDeck:$(n.trashDeck),trashDeck:[]})):(n.playerDeck[t].push(r),Object(O.a)({},n))}},ke=function(e,t){var n=e.card;return function(e){return e.trashDeck.push(n),e.playerDeck[t]=e.playerDeck[t].filter((function(e){var t=e.suit,r=e.number;return!(t===n.suit&&r===n.number)})),e}},ge=function(e){var t=(e.turn+e.maxPlayer+e.direction)%e.maxPlayer;return Object(O.a)(Object(O.a)({},e),{},{turn:t})},je=function e(t){return!t.dead[t.turn]&&function(e,t){var n=1/0,r=0;return t.forEach((function(t,a){var c=t.suit,i=t.number,o=0;if(c===oe.SPADE&&1===i)return[0,a];(o=10===i?e-10:12===i?e-20:13===i?99:e+le[i])<n&&(n=o,r=a)})),[n,r]}(t.points,t.playerDeck[t.turn])[0]>99&&(t.logs.push("".concat(t.players[t.turn]," die, his card: ").concat(t.playerDeck[t.turn].map((function(e){return"".concat(oe[e.suit]).concat(e.number)})).join(","))),t.dead[t.turn]=!0),Object.keys(t.dead).length===t.players.length-1&&t.started&&(t.winner=[0,1,2,3].filter((function(e){return!t.dead[e]}))[0]),t.dead[t.turn]?e(ge(Object(O.a)(Object(O.a)({},t),{},{turn:t.turn}))):Object(O.a)(Object(O.a)({},t),{},{turn:t.turn})},Ee=function(e,t){console.log("poker99 reducer");var n=t.peerId;if(void 0===n)throw new Error("Expect peerId in action");switch(t.type){case K.START:return function(e){(e=Object(O.a)(Object(O.a)({},e),{},{drawDeck:[],trashDeck:[],playerDeck:[],points:0,direction:1,turn:0,dead:{},logs:["game started"],winner:void 0})).drawDeck=$(function(){for(var e=[],t=0;t<4;t++)for(var n=1;n<=13;n++)e.push({suit:t,number:n});return e}());for(var t=0;t<e.players.length;t++){e.playerDeck[t]=[];for(var n=0;n<5;n++)e=we(t)(e)}return Object(O.a)({},e)}(e);case ie.PLAY_CARD:return function(e,t){return function(n){var r=t.card,a="".concat(oe[r.suit]).concat(r.number);if(void 0===n.playerDeck[e].find((function(e){var t=e.suit,n=e.number;return t===r.suit&&n===r.number})))throw new Error("".concat(n.players[e]," doesnt own card ").concat(a));if(n.turn!==e)throw new Error("not your turn");return Z.apply(void 0,[we(e)].concat(Object(k.a)([ke,fe,pe,ve,me,be,ye,Oe].map((function(n){return n(t,e)})))))(n)}}(function(){var t=e.nameDict[e.members[n]];if(void 0===t)throw new Error("game not started");return t}(),t.payload)(L()(e));case ie.END:return Object(O.a)(Object(O.a)({},e),{},{started:!1})}return e},Ae=n(45),Se=function(e){return[4,5,11,13].includes(e.number)},xe=function(e,t){var n=e.playerDeck[t],r=e.points,a=n.filter(he).sort((function(e,t){return le[t.number]-le[e.number]}));console.log("normal cards",a,"points",r);var c=n.find((function(e){return 13===e.number}));if(void 0!==c&&99!==r&&a.length<3)return{type:ie.PLAY_CARD,payload:{card:c}};var i,o=Object(Ae.a)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(console.log("should play normal?",s,r+le[s.number]<=99),r+le[s.number]<=99)return{type:ie.PLAY_CARD,payload:{card:s}}}}catch(w){o.e(w)}finally{o.f()}var u,l=n.filter(de),f=Object(Ae.a)(l.sort((function(e,t){return t.number-e.number})));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(r+le[h.number]<=99)return{type:ie.PLAY_CARD,payload:{card:h,increase:!0}}}}catch(w){f.e(w)}finally{f.f()}var p=n.find(Se);if(void 0!==p)return{type:ie.PLAY_CARD,payload:{card:p,target:e.nameDict[$(e.players.filter((function(n,r){return!e.dead[r]&&r!==t})))[0]]}};var d,v=Object(Ae.a)(l.sort((function(e,t){return e.number-t.number})));try{for(v.s();!(d=v.n()).done;){var m=d.value;if(r-le[m.number]<=99)return{type:ie.PLAY_CARD,payload:{card:m,increase:!1}}}}catch(w){v.e(w)}finally{v.f()}var b,y=Object(Ae.a)(n);try{for(y.s();!(b=y.n()).done;){var O=b.value;if(r-le[O.number]<=99)return{type:ie.PLAY_CARD,payload:{card:O,increase:!1}}}}catch(w){y.e(w)}finally{y.f()}throw new Error("reached an edge case")},Ce=Object(a.createContext)(null),Pe=function(){var e=Object(a.useContext)(Ce);if(null===e)throw new Error("please wrap it using withPoker99Network before calling this hook");return e},Le=function(){var e=Pe().connect,t=Object(a.useState)(Object(p.a)().substring(0,4)),n=Object(h.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)("my-room"),s=Object(h.a)(o,2),u=s[0],d=s[1],v=Object(a.useState)(""),m=Object(h.a)(v,2),b=m[0],y=m[1];return c.a.createElement("div",null,c.a.createElement("h1",null,"Demo Game - Poker 99"),""!==b&&c.a.createElement("div",null,b),c.a.createElement("div",null,c.a.createElement("label",null,"your name: ",c.a.createElement("input",{value:r,onChange:function(e){var t=e.target.value;return i(t)}}))),c.a.createElement("div",null,c.a.createElement("label",null,"room code: ",c.a.createElement("input",{value:u,onChange:function(e){var t=e.target.value;return d(t)}}))),c.a.createElement("button",{disabled:""===r||""===u,onClick:Object(f.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(r,u).catch((function(e){return y(e.message)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))},"join"))},De=function(){var e,t=Pe(),n=t.room,r=t.state,i=t.leave,o=t.isAdmin,s=t.myId,u=t.kick,p=t.ready,d=t.start,v=t.addAi,m=t.addLocal,b=t.playerType,O=Object(a.useState)(""),w=Object(h.a)(O,2),k=w[0],g=w[1],j=Object(a.useState)(""),E=Object(h.a)(j,2),A=E[0],S=E[1],x=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().catch((function(e){return g(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().catch((function(e){return g(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(""),e.next=3,m(A).catch((function(e){return g(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(""),e.next=3,v(A).catch((function(e){return g(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=(e={},Object(y.a)(e,F.NORMAL,""),Object(y.a)(e,F.LOCAL,"(local)"),Object(y.a)(e,F.AI,"(ai)"),e);return c.a.createElement("div",null,c.a.createElement("div",null,"Room: ",n),c.a.createElement("div",null,Object.entries(r.members).map((function(e){var t,n=Object(h.a)(e,2),a=n[0],i=n[1];return c.a.createElement("div",{key:i},i," ",D[b(i)],a!==s&&o&&c.a.createElement("button",{onClick:Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"kick"),null!==(t=r.ready[a])&&void 0!==t&&t&&"(ready)")}))),c.a.createElement("div",null,c.a.createElement("button",{onClick:i},"leave"),o?c.a.createElement("button",{onClick:x},"start"):c.a.createElement("button",{onClick:C},"ready")),c.a.createElement("div",null,c.a.createElement("input",{placeholder:"new local/ai player name",value:A,onChange:function(e){var t=e.target.value;return S(t)}}),c.a.createElement("button",{onClick:P},"Add local"),c.a.createElement("button",{onClick:L},"Add AI")),""!==k&&c.a.createElement("div",null,k))},_e=function(){var e=Pe(),t=e.state,n=e.dispatch,r=e.dispatchAs,i=e.myPlayerId,o=e.myLocals,s=e.hideDeck,u=e.setHideDeck,p=e.error,d=e.setError,v=e.renderedDeckId,m=Object(a.useState)(0),b=Object(h.a)(m,2),y=b[0],O=b[1],w=Object(a.useState)(!0),k=Object(h.a)(w,2),g=k[0],j=k[1],E=1===t.direction?">":"<",A=function(e){d(e.message)},S=function(e){return Object(f.a)(l.a.mark((function a(){var c;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c={type:ie.PLAY_CARD,payload:{card:e,increase:g,target:y}},t.turn!==i){a.next=6;break}return a.next=4,n(c).then((function(){return d("")})).catch(A);case 4:a.next=9;break;case 6:if(!o.includes(t.players[t.turn])){a.next=9;break}return a.next=9,r(t.turn,c).then((function(){return d("")})).catch(A);case 9:case"end":return a.stop()}}),a)})))},x=function(e){var n;return null===(n=t.playerDeck[e])||void 0===n?void 0:n.map((function(e){return c.a.createElement("button",{key:10*e.number+e.suit,onClick:S(e)},oe[e.suit]," ",e.number)}))},C=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({type:ie.END}).catch(A);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("h3",null,t.points),c.a.createElement("h6",null,t.players[t.turn],"'","s turn"),""!==p&&c.a.createElement("div",{style:{color:"red"}},p),void 0!==t.winner&&c.a.createElement("div",null,"winner is ",t.players[t.winner],c.a.createElement("button",{onClick:C},"again")),t.players.map((function(e,n){return c.a.createElement("span",{key:e,onClick:function(){return O(n)},style:{fontWeight:t.turn===n?"bold":"normal",textDecorationLine:t.dead[n]?"line-through":"none"}},e," ",E)})),c.a.createElement("div",null,0===o.length?x(i):s?c.a.createElement("button",{onClick:function(){return u(!1)}},"show ",t.players[v]):x(v)),c.a.createElement("div",null,"target: ",y),c.a.createElement("button",{onClick:function(){return j(!g)}},g?"+":"-")),c.a.createElement("div",null,t.logs.slice().reverse().map((function(e,t){return c.a.createElement("div",{key:t},e)}))))},Re=function(e){var t=function(t){var n=function(e,t,n){var r=se(function(e){return function(t,n){return e(t,n)}}(e),t),c=r.myLocals,i=r.myPlayerId,o=r.myAis,s=r.dispatchAs,u=r.state,l=Object(a.useState)(""),f=Object(h.a)(l,2),p=f[0],d=f[1],v=Object(a.useState)(c.length>0),m=Object(h.a)(v,2),b=m[0],y=m[1],w=Object(a.useState)(i),k=Object(h.a)(w,2),g=k[0],j=k[1],E=Object(a.useRef)(-1);u.turn!==E.current&&(c.length>0&&(b=!0,y(!0),j(u.turn)),E.current=u.turn);var A=function(e){d(e.message)};return Object(a.useEffect)((function(){if(o.includes(u.players[u.turn])&&u.started&&void 0===u.winner){var e=window.setTimeout((function(){var e=n(u,u.turn);s(u.turn,e).catch(A)}),500);return function(){window.clearTimeout(e)}}}),[u]),Object(O.a)(Object(O.a)({},r),{},{state:u,hideDeck:b,setHideDeck:y,error:p,setError:d,renderedDeckId:g})}(Ee,new ue,xe);return c.a.createElement(Ce.Provider,{value:n},c.a.createElement(e,t))};return t.displayName="WithGameNetwork",t}((function(){switch(Pe().gameAppState){case Q.HOME:return c.a.createElement(Le,null);case Q.ROOM:return c.a.createElement(De,null);case Q.GAME:return c.a.createElement(_e,null);default:throw new Error("unknown state")}}));o.a.render(c.a.createElement(Re,null),document.getElementById("root")),s()}},[[133,1,2]]]);
//# sourceMappingURL=main.fd9eba65.chunk.js.map