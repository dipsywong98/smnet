(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{5953:function(e,t,n){e.exports=n(6063)},5958:function(e,t,n){},5960:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=5960},5965:function(e,t){},5967:function(e,t){},5977:function(e,t){},5979:function(e,t){},6006:function(e,t){},6007:function(e,t){},6012:function(e,t){},6014:function(e,t){},6038:function(e,t){},6063:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),i=n(14),o=n.n(i),s=(n(5958),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,6118)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))}),u=n(5),l=n(3),f=n.n(l),h=n(7),p=n(15),d=n(28),m=n(29),v=n(33),y=n(34),b=n(21),w=n(16),g=n(44),O=n(78),k=n(23),j=n(188),E=n.n(j),A=n(76),x=n.n(A),S=n(72),C=n(59),P=n.n(C);!function(e){e.DISPATCH="DISPATCH",e.ACK="ACK",e.NACK="NACK",e.PROMOTE="PROMOTE",e.CANCEL="CANCEL",e.SET_STATE="SET_STATE",e.ASK_STATE="ASK_STATE",e.KICK="KICK"}(r||(r={}));var L,D=function(){function e(t){if(Object(w.a)(this,e),void 0!==t)this._options=t;else{var n='{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}';this._options={host:null!=="peer.hkustracing.com"?"peer.hkustracing.com":"localhost",port:Number.parseInt(null!=="443"?"443":"9000",10),path:null!=="/"?"/":"/peer",secure:!0,config:JSON.parse(n)}}}return Object(k.a)(e,[{key:"make",value:function(e){return new E.a(e,this._options)}},{key:"makeAndOpen",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.make(t),e.next=3,new Promise((function(e,t){n.on("open",(function(){e(n)})),n.on("error",(function(){t(n)}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="already joined network",e.name="AlreadyJoinedNetworkError",e}return n}(Object(O.a)(Error)),N=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(w.a)(this,n),(r=t.call(this)).name="PlayerNameAlreadyExistError",r.message="not connected to ".concat(e),r}return n}(Object(O.a)(Error)),R=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="No Staging State",e.name="NoStagingStateError",e}return n}(Object(O.a)(Error)),T=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).message="Network is busy, please retry later",e.name="NetworkBusyError",e}return n}(Object(O.a)(Error));!function(e){e[e.ALL=0]="ALL",e[e.TRACE=1]="TRACE",e[e.LOG=2]="LOG",e[e.DEBUG=3]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=5]="WARN",e[e.ERROR=6]="ERROR",e[e.OFF=7]="OFF"}(L||(L={}));var I=function(){function e(t,n,r){var a=this;Object(w.a)(this,e),this._logs=[],this.pushLog=function(e,t){a._logs.length>=a._keep&&a._logs.shift();for(var n=arguments.length,r=new Array(n>2?n-2:0),c=2;c<n;c++)r[c-2]=arguments[c];a._logs.push({level:e,message:r,date:new Date})},this.getLogFunction=function(e){if(e<a._verboseLevel)return function(){};switch(e){case L.INFO:return console.info.bind(window.console);case L.LOG:case L.DEBUG:return console.log.bind(window.console);case L.ERROR:return console.error.bind(window.console);case L.WARN:return console.warn.bind(window.console);case L.TRACE:return console.trace.bind(window.console);default:return function(){}}},this.withColor=function(e,t){return function(n){var r,a=(r={},Object(b.a)(r,L.INFO,"color: DodgerBlue"),Object(b.a)(r,L.LOG,""),Object(b.a)(r,L.DEBUG,"color: Green"),Object(b.a)(r,L.ERROR,""),Object(b.a)(r,L.WARN,""),Object(b.a)(r,L.TRACE,"color: Green"),Object(b.a)(r,L.ALL,""),Object(b.a)(r,L.OFF,""),r)[e],c=void 0===t?"%c[".concat(L[e],"]"):"%c[".concat(t.toISOString()," ").concat(L[e],"]");return Function.prototype.bind.call(n,console,c,a)}},this.withHistoryButWrongLineNumber=function(e){return function(t){return new Proxy(t,{apply:function(t,n,r){var c=new Date;return a.pushLog.apply(a,[e,c].concat(Object(g.a)(r))),t.apply(void 0,Object(g.a)(r))}})}},this.withAllFeatures=function(e){return e>=a._historyLevel?a.withHistoryButWrongLineNumber(e)(a.withColor(e)(a.getLogFunction(e))):a.withColor(e)(a.getLogFunction(e))},this.clear=function(){a._logs.splice(0,a._logs.length)},this.printLogs=function(){a._logs.forEach((function(e){var t=e.level,n=e.message,r=e.date;a.withColor(t,r)(a.getLogFunction(t)).apply(void 0,Object(g.a)(n))}))},this.getLogs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.ALL;return a._logs.filter((function(t){return t.level>=e}))},this._historyLevel=t,this._verboseLevel=n,this._keep=r}return Object(k.a)(e,[{key:"historyLevel",set:function(e){this._historyLevel=e}},{key:"verboseLevel",set:function(e){this._verboseLevel=e}},{key:"keep",set:function(e){this._keep=e}},{key:"info",get:function(){return this.withAllFeatures(L.INFO)}},{key:"log",get:function(){return this.withAllFeatures(L.LOG)}},{key:"debug",get:function(){return this.withAllFeatures(L.DEBUG)}},{key:"error",get:function(){return this.withAllFeatures(L.ERROR)}},{key:"warn",get:function(){return this.withAllFeatures(L.WARN)}},{key:"trace",get:function(){return this.withAllFeatures(L.TRACE)}}]),e}(),M=new I(L.ALL,L.WARN,100);M.historyLevel=L.OFF,M.verboseLevel=L.ALL;var H,K,F=function(){function e(t,n){Object(w.a)(this,e),this.isAdmin=!0,this.leaving=!1,this.network=t,this.peerFactory=n}return Object(k.a)(e,[{key:"handlePromote",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=12;break}if((n=x()(JSON.stringify(this.stagingState)))!==t){e.next=8;break}this.network.setState(this.stagingState),M.info("promoted the stagingState",this.stagingState),this.stagingState=void 0,e.next=10;break;case 8:throw M.error("Cannot promote, staging checksum is ".concat(n," while requested to promote checksum of ").concat(t)),new Error("Cannot promote staging state with unmatched checksum");case 10:e.next=14;break;case 12:throw M.error("Cannot promote, there is no staging state"),new R;case 14:return e.next=16,Promise.resolve();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleCancel",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=11;break}if((n=x()(JSON.stringify(this.stagingState)))!==t){e.next=7;break}M.info("canceled the stagingState",this.stagingState),this.stagingState=void 0,e.next=9;break;case 7:throw M.error("Cannot cancel, staging checksum is ".concat(n," while requested to cancel checksum of ").concat(t)),new Error("Cannot cancel staging state with unmatched checksum");case 9:e.next=13;break;case 11:throw M.error("Cannot cancel, there is no staging state"),new R;case 13:return e.next=15,Promise.resolve();case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){M.info("force cancel the stagingState"),this.stagingState=void 0}},{key:"isBusy",value:function(){return void 0!==this.stagingState}}]),e}(),B=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout((function(){e()}),t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){return Object(w.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"dispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n,a,c,i,o,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,M.debug("reduce locally",this.network.getState(),t),this.stagingState=this.network.applyReducer(this.network.getState(),t),a=x()(JSON.stringify(this.stagingState)),M.debug("stagingState",this.stagingState),e.next=7,this.network.broadcast(r.DISPATCH,t);case 7:if(c=e.sent,M.debug("obtained responses",c),i=[],o=[],s=[],c.forEach((function(e){var t=e.conn,n=e.data,r=e.error;void 0!==r?i.push({error:r,conn:t}):n!==a?o.push(t):s.push(t)})),s.length===c.length?M.debug("all can be promoted"):(i.length>0&&M.error("received ".concat(i.length," error from some peers"),i),o.length>0&&M.warn("received ".concat(o.length," unmatched checksum from some peer, forceUpdating them"),o)),!(i.length>0)){e.next=20;break}return e.next=17,this.network.broadcast(r.CANCEL,a);case 17:throw new Error(i[0].error);case 20:o.map(function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.SET_STATE,n.stagingState);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.map(function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.network.send(t,r.PROMOTE,a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 22:return e.next=24,this.handlePromote(a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch(n);case 2:return e.abrupt("return",this.network.getState());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.dispatchMemberLeft(e.peer).catch(M.error)}))}},{key:"dispatchMemberLeft",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.leaving){e.next=12;break}return e.prev=1,e.next=4,this.network.dispatch({type:"member-left",payload:t});case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,B(1e3);case 10:return e.next=12,this.dispatchMemberLeft(t);case 12:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(F),W=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(w.a)(this,n),(e=t.apply(this,arguments)).isAdmin=!1,e}return Object(k.a)(n,[{key:"dispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.broadcast(r.DISPATCH,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stagingState=this.network.applyReducer(t,n),e.next=3,Promise.resolve(this.stagingState);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t=this;e.on("close",(function(){t.leaving||t.recover().catch(M.error)}))}},{key:"recover",value:function(){var e=Object(h.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=this.network.getNetworkName())){e.next=17;break}return e.prev=2,n=this.network.myId,M.debug("oldId",n),e.next=7,this.network.initAsStarHost(t,this.peerFactory);case 7:if(M.info("became the new host, changed peerId, notify others"),void 0===n){e.next=11;break}return e.next=11,this.dispatchHostLeft(n);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(2),e.next=17,this.network.reconnectToHost(t);case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"dispatchHostLeft",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.network.dispatch({type:"host-left",payload:t});case 3:e.next=11;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,B(1e3);case 9:return e.next=11,this.dispatchHostLeft(t);case 11:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(F),G=function(){function e(){Object(w.a)(this,e),this.connections={},this.sentPromises={}}return Object(k.a)(e,[{key:"reset",value:function(){this.connections={}}},{key:"registerConnection",value:function(e){this.connections[e.peer]=e}},{key:"unregisterConnection",value:function(e){var t=this.connections,n=e.peer,r=(t[n],Object(v.a)(t,[n].map(y.a)));this.connections=r}},{key:"getConnections",value:function(){return this.connections}},{key:"send",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n,r){var a,c=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getConn(t),e.next=3,new Promise((function(e,t){var i=Object(S.v4)();c.sentPromises[i]={resolve:function(t){return e({conn:a,data:t})},reject:function(e){return t(new Error(e))}},a.send({pkgType:n,data:r,pid:i})}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.ACK,pid:t,data:n})}},{key:"sendNACK",value:function(e,t,n){this.getConn(e).send({pkgType:r.NACK,pid:t,data:n})}},{key:"broadcast",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=Object.keys(this.connections).map(function(){var e=Object(h.a)(f.a.mark((function e(a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.send(a,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"receiveACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].resolve)(t),this.removeSentPromise(e))}},{key:"receiveNACK",value:function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].reject)(t),this.removeSentPromise(e))}},{key:"removeSentPromise",value:function(e){var t=this.sentPromises,n=(t[e],Object(v.a)(t,[e].map(y.a)));this.sentPromises=n}},{key:"getConn",value:function(e){if("string"===typeof e){var t=this.connections[e];if(void 0!==t)return t;throw new N(e)}return e}}]),e}(),Y=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(w.a)(this,e),this.history=[],this.historyMax=a,this.initialState=P()(t),this._reset=function(){return r.set(P()(r.initialState))},this.state=t,this._set=null!==n&&void 0!==n?n:function(e){r.state=e}}return Object(k.a)(e,[{key:"get",value:function(){return this.state}},{key:"set",value:function(e){this.state=e,this.historyMax>0&&(this.history.length>=this.historyMax&&this.history.shift(),this.history.push(P()(e))),this._set(Object(u.a)({},e))}},{key:"reset",value:function(){this._reset()}},{key:"getHistory",value:function(){return this.history}}],[{key:"make",value:function(t,n,r){return new e(t,n,r)}}]),e}(),J=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){return Object(w.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"dispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw M.error("cannot dispatch when there is staging state",this.stagingState),new T;case 3:return e.next=5,this.wrappedStrategy.dispatch(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.stagingState){e.next=3;break}throw M.error("cannot handle dispatch request when there is staging state",this.stagingState),new T;case 3:return e.next=5,this.wrappedStrategy.handleDispatch(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(){function e(t){Object(w.a)(this,e),this.wrappedStrategy=t}return Object(k.a)(e,[{key:"dispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.dispatch(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceCancel",value:function(){return this.wrappedStrategy.forceCancel()}},{key:"handleCancel",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleCancel(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handleDispatch(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handlePromote",value:function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wrappedStrategy.handlePromote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isBusy",value:function(){return this.wrappedStrategy.isBusy()}},{key:"setUpConnection",value:function(e){return this.wrappedStrategy.setUpConnection(e)}},{key:"stagingState",get:function(){return this.wrappedStrategy.stagingState},set:function(e){this.wrappedStrategy.stagingState=e}},{key:"network",get:function(){return this.wrappedStrategy.network}},{key:"leaving",get:function(){return this.wrappedStrategy.leaving},set:function(e){this.wrappedStrategy.leaving=e}},{key:"isAdmin",get:function(){return this.wrappedStrategy.isAdmin},set:function(e){this.wrappedStrategy.isAdmin=e}}]),e}()),V=function(e){return new J(e)},z=function(){function e(t,n){var a=this;Object(w.a)(this,e);var c=this;this.dataStream=new G,this.getHistory=function(){return a.stateManager.getHistory()},this.kick=function(){var e=Object(h.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=null===(a=c.getNeighbor())||void 0===a?void 0:a.includes(t))||void 0===n||!n){e.next=5;break}return e.next=3,c.send(t,r.KICK,t);case 3:e.next=7;break;case 5:return e.next=7,c.broadcast(r.KICK,t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.stateManager=n instanceof Y?n:Y.make(n),this.stateReducer=t}return Object(k.a)(e,[{key:"getNetworkName",value:function(){return this.networkName}},{key:"setState",value:function(e){this.stateManager.set(e)}},{key:"getState",value:function(){return this.stateManager.get()}},{key:"applyReducer",value:function(e,t){return this.stateReducer(e,t)}},{key:"reduce",value:function(e){this.stateManager.set(this.stateReducer(this.stateManager.get(),e))}},{key:"leave",value:function(){var e=Object(h.a)(f.a.mark((function e(){var t,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=10;break}return void 0!==this.networkStrategy&&(this.networkStrategy.leaving=!0),t=new Promise((function(e){var t;return null===(t=n.peer)||void 0===t?void 0:t.on("close",e)})),this.peer.destroy(),e.next=6,t;case 6:this.peer=void 0,this.networkName=void 0,this.dataStream.reset(),this.stateManager.reset();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.peer){e.next=2;break}throw new _;case 2:return n=null!==(r=n)&&void 0!==r?r:new D,e.prev=3,e.next=6,this.initAsStarHost(t,n);case 6:this.stateManager.reset(),this.setState(Object(u.a)(Object(u.a)({},this.getState()),{},{networkName:t})),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(3),M.info("cannot init as host, try to init as member"),e.next=15,this.initAsStarMember(t,n);case 15:return e.next=17,this.dispatch({type:"member-join"});case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarHost",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){var r,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.info("initing as host"),r=this.peer,e.next=4,n.makeAndOpen(t);case 4:this.peer=e.sent,this.peer.on("connection",(function(e){M.info("received connection with",e.peer),a.setUpConnection(e)})),this.networkName=t,this.networkStrategy=V(new U(this,n)),null===r||void 0===r||r.destroy(),M.info("inited as host");case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initAsStarMember",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.info("initing as member"),this.networkStrategy=V(new W(this,n)),e.next=4,n.makeAndOpen();case 4:return this.peer=e.sent,M.info("opened peer"),e.next=8,this.reconnectToHost(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reconnectToHost",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n,a,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.peer){e.next=2;break}return e.abrupt("return");case 2:return n=this.peer.connect(t),this.setUpConnection(n),e.next=6,new Promise((function(e,t){n.on("open",(function(){e()})),n.on("error",(function(e){t(e)}))}));case 6:return M.info("opened connection with host"),this.dataStream.registerConnection(n),this.networkName=t,M.info("requesting state from host"),e.next=12,this.dataStream.send(t,r.ASK_STATE,void 0);case 12:a=e.sent,void 0!==(c=a.data)&&(M.info("updating the state got from host",c),this.setState(c)),M.info("inited as member");case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNeighbor",value:function(){if(void 0!==this.peer)return Object.keys(this.dataStream.getConnections())}},{key:"send",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.send(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"broadcast",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStream.broadcast(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"dispatch",value:function(){var e=Object(h.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.peerId=null!==(n=t.peerId)&&void 0!==n?n:this.myId,void 0===this.myId||null===this.myId){e.next=8;break}return M.info("dispatching action",t),e.next=5,null===(r=this.networkStrategy)||void 0===r?void 0:r.dispatch(t);case 5:M.info("dispatched action",t),e.next=9;break;case 8:M.error("not connected");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setUpConnection",value:function(e){var t,n=this;e.on("open",(function(){M.info("opened connection with",e.peer),n.dataStream.registerConnection(e)})),e.on("close",(function(){M.info("closed connection with",e.peer),n.dataStream.unregisterConnection(e)})),e.on("data",(function(t){return n.dataHandler(t,e)})),null===(t=this.networkStrategy)||void 0===t||t.setUpConnection(e)}},{key:"dataHandler",value:function(e,t){var n,a,c,i,o=this,s=e.pid,u=e.pkgType,l=e.data;switch(M.debug("received pkg from",t.peer,e),u){case r.DISPATCH:null===(n=this.networkStrategy)||void 0===n||n.handleDispatch(this.getState(),l).then((function(e){var n=x()(JSON.stringify(e));o.dataStream.sendACK(t,s,n)})).catch((function(e){o.dataStream.sendNACK(t,s,e.message)}));break;case r.ACK:this.dataStream.receiveACK(s,l);break;case r.NACK:this.dataStream.receiveNACK(s,l);break;case r.PROMOTE:null===(a=this.networkStrategy)||void 0===a||a.handlePromote(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.CANCEL:null===(c=this.networkStrategy)||void 0===c||c.handleCancel(l).then((function(){return o.dataStream.sendACK(t,s,l)})).catch((function(e){return o.dataStream.sendNACK(t,s,e.message)}));break;case r.SET_STATE:this.setState(l),null===(i=this.networkStrategy)||void 0===i||i.forceCancel();break;case r.ASK_STATE:this.dataStream.sendACK(t,s,this.state);break;case r.KICK:l===this.myId?(M.info("you got kicked out of network"),this.leave().catch(M.error)):this.send(l,u,l).catch(M.error)}}},{key:"myId",get:function(){var e;return null===(e=this.peer)||void 0===e?void 0:e.id}},{key:"connected",get:function(){return void 0!==this.networkName}},{key:"state",get:function(){return this.getState()}},{key:"isAdmin",get:function(){var e,t;return null!==(e=null===(t=this.networkStrategy)||void 0===t?void 0:t.isAdmin)&&void 0!==e&&e}}]),e}();!function(e){e.MEMBER_JOIN="member-join",e.MEMBER_LEFT="member-left",e.HOST_LEFT="host-left",e.RENAME="rename",e.READY="ready",e.START="start",e.ADD_AI="add-ai",e.ADD_LOCAL="add-local",e.REMOVE_LOCAL_AI="remove-local-ai"}(H||(H={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LOCAL=1]="LOCAL",e[e.AI=2]="AI"}(K||(K={}));var q,Q=function e(){Object(w.a)(this,e),this.minPlayer=1,this.maxPlayer=4,this.members={},this.spectators={},this.localPlayers={},this.aiPlayers={},this.nameDict={},this.players=[],this.ready={},this.started=!1},X=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reverse().reduce((function(e,t){return t(e)}),e)}},Z=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}return e},$=function(e){return function(t){if(e in t.members)throw new Error("peerId ".concat(e," already joined this room"));return(t.maxPlayer>0&&Object.values(t.members).length>=t.maxPlayer||t.started)&&(t.spectators[e]=!0),Object(u.a)(Object(u.a)({},t),{},{members:Object(u.a)(Object(u.a)({},t.members),{},Object(b.a)({},e,""))})}},ee=function(e,t){return function(n){if(Object.values(n.members).includes(t))throw new Error("there is already someone named ".concat(t));if(n.started&&Object.keys(n.nameDict).includes(t)){var r=n.spectators,a=(r[e],Object(v.a)(r,[e].map(y.a)));n.spectators=a}return Object(u.a)(Object(u.a)({},n),{},{members:Object(u.a)(Object(u.a)({},n.members),{},Object(b.a)({},e,t))})}},te=function(e,t){return function(n){var r={},a={};return Object.entries(n.localPlayers).forEach((function(n){var a=Object(p.a)(n,2),c=a[0],i=a[1];i!==e?r[c]=i:void 0!==t&&(r[c]=t)})),Object.entries(n.aiPlayers).forEach((function(n){var r=Object(p.a)(n,2),c=r[0],i=r[1];i!==e?a[c]=i:void 0!==t&&(a[c]=t)})),Object(u.a)(Object(u.a)({},n),{},{localPlayers:r,aiPlayers:a})}},ne=function(e){return function(t){var n=t.members,r=(n[e],Object(v.a)(n,[e].map(y.a))),a=t.localPlayers,c=(a[e],Object(v.a)(a,[e].map(y.a))),i=t.aiPlayers,o=(i[e],Object(v.a)(i,[e].map(y.a)));return Object(u.a)(Object(u.a)({},t),{},{members:r,localPlayers:c,aiPlayers:o})}},re=function(e){return function(t){if(t.started)throw new Error("Started already");var n=Object.keys(t.members).filter((function(t){return t!==e})).filter((function(e){return!t.spectators[e]})).filter((function(e){return void 0===t.localPlayers[e]})).filter((function(e){return void 0===t.aiPlayers[e]})).filter((function(e){var n;return void 0!==e&&!(null!==(n=t.ready[e])&&void 0!==n&&n)}));if(0===n.length)return function(e){var t=Z(Object.entries(e.members).filter((function(t){var n=Object(p.a)(t,1)[0];return!e.spectators[n]})).map((function(e){return e[1]})));if(t.length>e.maxPlayer)throw new Error("Too much players, max: ".concat(e.maxPlayer,", got: ").concat(t.length));if(t.length<e.minPlayer)throw new Error("Not enough players, min: ".concat(e.minPlayer,", got: ").concat(t.length));var n={};return t.forEach((function(e,t){n[e]=t})),Object(u.a)(Object(u.a)({},e),{},{nameDict:n,players:t})}(Object(u.a)(Object(u.a)({},t),{},{started:!0}));throw new Error("".concat(n.map((function(e){return t.members[e]})).join(",")," not ready yet"))}},ae=function(e,t){var n=t.peerId;if(void 0===n)throw new Error("expect peerId in action");var r,a,c=e.networkName;if(void 0===c)throw new Error("expect networkName in prevState");switch(t.type){case H.MEMBER_JOIN:return $(n)(e);case H.RENAME:return ee(n,t.payload)(e);case H.MEMBER_LEFT:return X(te(t.payload,c),ne(t.payload))(e);case H.HOST_LEFT:return X(te(t.payload,c),ee(c,e.members[t.payload]),ne(t.payload))(e);case H.READY:return function(e){return function(t){if(t.ready[e]){var n=t.ready,r=(n[e],Object(v.a)(n,[e].map(y.a)));return Object(u.a)(Object(u.a)({},t),{},{ready:r})}return Object(u.a)(Object(u.a)({},t),{},{ready:Object(u.a)(Object(u.a)({},t.ready),{},Object(b.a)({},e,!0))})}}(n)(e);case H.START:return re(c)(e);case H.ADD_AI:return(r=t.payload,a=n,function(e){var t="ai-".concat(r,"-").concat(Object(S.v4)()),n=X(ee(t,r),$(t))(e);return Object(u.a)(Object(u.a)({},n),{},{aiPlayers:Object(u.a)(Object(u.a)({},n.aiPlayers),{},Object(b.a)({},t,a))})})(e);case H.ADD_LOCAL:return function(e,t){return function(n){var r="local-".concat(e,"-").concat(Object(S.v4)()),a=X(ee(r,e),$(r))(n);return Object(u.a)(Object(u.a)({},a),{},{localPlayers:Object(u.a)(Object(u.a)({},a.localPlayers),{},Object(b.a)({},r,t))})}}(t.payload,n)(e);case H.REMOVE_LOCAL_AI:return ne(t.payload)(e);default:return e}};!function(e){e[e.HOME=0]="HOME",e[e.ROOM=1]="ROOM",e[e.GAME=2]="GAME"}(q||(q={}));var ce,ie,oe=function(e,t){var n=Object(a.useState)(q.HOME),r=Object(p.a)(n,2),c=r[0],i=r[1],o=function(e,t){var n=Object(a.useState)(t),r=Object(p.a)(n,2),c=r[0],i=r[1],o=Object(a.useMemo)((function(){return new z(e,Y.make(t,i,10))}),[]);return Object(a.useEffect)((function(){return void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_PEER_CONFIG:'{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}',REACT_APP_PEER_HOST:"peer.hkustracing.com",REACT_APP_PEER_PATH:"/",REACT_APP_PEER_PORT:"443",REACT_APP_PEER_SECURE:"true",REACT_APP_SMNET_VERBOSE_ALL_NO_HISTORY:"true"}).REACT_APP_DISABLE_SMNET_WINDOW_VAR&&(window.stateHistory=o.getHistory,window.smnetLog=M,window.network=o),function(){o.leave().catch(M.error)}}),[o]),Object.freeze({join:o.join.bind(o),leave:o.leave.bind(o),dispatch:o.dispatch.bind(o),state:c,connected:o.connected,networkName:o.getNetworkName(),isAdmin:o.isAdmin,myId:o.myId,kick:o.kick})}(function(e){return function(t,n){return e(ae(t,n),n)}}(e),t),s=o.state,l=o.myId,d=Object(a.useMemo)((function(){try{return s.nameDict[s.members[l]]}catch(e){return-1}}),[l,s]),m=Object(a.useMemo)((function(){try{return Object.keys(s.localPlayers).filter((function(e){return s.localPlayers[e]===l})).map((function(e){return s.members[e]}))}catch(e){return[]}}),[l,s]),v=Object(a.useMemo)((function(){try{return Object.keys(s.aiPlayers).filter((function(e){return s.aiPlayers[e]===l})).map((function(e){return s.members[e]}))}catch(e){return[]}}),[l,s]),y=function(e){return Object.keys(s.members).filter((function(t){return s.members[t]===s.players[e]}))[0]},b=function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch(Object(u.a)(Object(u.a)({},n),{},{peerId:y(t)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.RENAME,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.READY});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.START});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.ADD_LOCAL,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch({type:H.ADD_AI,payload:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(h.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,M.info("connecting",n),e.next=4,o.join(n);case 4:return M.info("entering with name",t),e.next=7,w(t);case 7:M.info("connected",n),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(0),M.error(e.t0),e.next=15,A();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M.info("leaving"),e.next=3,o.leave();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M.info("leaving"),!(t in o.state.aiPlayers)&&!(t in o.state.localPlayers)){e.next=6;break}return e.next=4,o.dispatch({type:H.REMOVE_LOCAL_AI,payload:t});case 4:e.next=8;break;case 6:return e.next=8,o.kick(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){o.state.started&&void 0!==o.networkName?i(q.GAME):void 0!==o.networkName?i(q.ROOM):i(q.HOME)}),[o.state,o.networkName]),{connect:E,gameAppState:c,state:s,room:o.networkName,leave:A,isAdmin:o.isAdmin,myId:l,kick:x,ready:g,start:O,dispatch:o.dispatch,addLocal:k,addAi:j,playerType:function(e){var t,n="string"===typeof e?e:o.state.players[e],r=null===(t=Object.entries(o.state.members).find((function(e){var t=Object(p.a)(e,2),r=(t[0],t[1]);return n===r})))||void 0===t?void 0:t[0];return void 0===r?K.NORMAL:r in o.state.aiPlayers?K.AI:r in o.state.localPlayers?K.LOCAL:K.NORMAL},myPlayerId:d,myLocals:m,myAis:v,getPeerId:y,dispatchAs:b}},se=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(w.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).maxPlayer=4,e.minPlayer=4,e.turn=0,e.direction=1,e.points=0,e.dead={},e.drawDeck=[],e.trashDeck=[],e.playerDeck=[],e.winner=void 0,e.logs=[],e}return n}(Q);!function(e){e[e.PLAY_CARD=0]="PLAY_CARD",e[e.LOCAL_MOVE=1]="LOCAL_MOVE",e[e.END=2]="END"}(ce||(ce={})),function(e){e[e.SPADE=0]="SPADE",e[e.HEART=1]="HEART",e[e.CLUB=2]="CLUB",e[e.DIAMOND=3]="DIAMOND"}(ie||(ie={}));var ue={1:1,2:2,3:3,4:0,5:0,6:6,7:7,8:8,9:9,10:10,11:0,12:20,13:99},le=function(e){var t=e.card;return function(e){return function(e){return 13===e.number}(t)?(e.points=99,ke(Oe(e))):e}},fe=function(e){return(e.suit!==ie.SPADE||1!==e.number)&&[1,2,3,6,7,8,9].includes(e.number)},he=function(e){var t=e.card;return function(e){if(fe(t)){var n=e.points+ue[t.number];if(n>99)throw new Error("playing this card will exceed 99");return ke(Oe(Object(u.a)(Object(u.a)({},e),{},{points:n})))}return e}},pe=function(e){return 10===e.number||12===e.number},de=function(e){var t=e.card,n=e.increase;return function(e){if(pe(t)){if(void 0===n)throw new Error("increase is required in payload");var r=e.points+(n?ue[t.number]:-ue[t.number]);if(r>99)throw new Error("playing this card will exceed 99");return ke(Oe(Object(u.a)(Object(u.a)({},e),{},{points:r})))}return e}},me=function(e){var t=e.card;return function(e){return function(e){return 4===e.number}(t)?(e.direction*=-1,ke(Oe(e))):e}},ve=function(e){var t=e.card;return function(e){return function(e){return 11===e.number}(t)?ke(Oe(e)):e}},ye=function(e,t){var n=e.card,r=e.target;return function(e){if(function(e){return 5===e.number}(n)){if(void 0===r)throw new Error("target is required in payload");if(r===t)throw new Error("cannot target myself");return e.turn=r,ke(e)}return e}},be=function(e){var t=e.card;return function(e){return function(e){return 1===e.number&&e.suit===ie.SPADE}(t)?(e.points=1,ke(Oe(e))):e}},we=function e(t){return function(n){if(n.playerDeck[t].length>=5)throw new Error("cannot draw, ".concat(n.players[t]," already has ").concat(5," cards"));var r=n.drawDeck.shift();return void 0===r?e(t)(Object(u.a)(Object(u.a)({},n),{},{drawDeck:Z(n.trashDeck),trashDeck:[]})):(n.playerDeck[t].push(r),Object(u.a)({},n))}},ge=function(e,t){var n=e.card;return function(e){return e.trashDeck.push(n),e.playerDeck[t]=e.playerDeck[t].filter((function(e){var t=e.suit,r=e.number;return!(t===n.suit&&r===n.number)})),e}},Oe=function(e){var t=(e.turn+e.maxPlayer+e.direction)%e.maxPlayer;return Object(u.a)(Object(u.a)({},e),{},{turn:t})},ke=function e(t){return!t.dead[t.turn]&&function(e,t){var n=1/0,r=0;return t.forEach((function(t,a){var c=t.suit,i=t.number,o=0;if(c===ie.SPADE&&1===i)return[0,a];(o=10===i?e-10:12===i?e-20:13===i?99:e+ue[i])<n&&(n=o,r=a)})),[n,r]}(t.points,t.playerDeck[t.turn])[0]>99&&(t.logs.push("".concat(t.players[t.turn]," die, his card: ").concat(t.playerDeck[t.turn].map((function(e){return"".concat(ie[e.suit]).concat(e.number)})).join(","))),t.dead[t.turn]=!0),Object.keys(t.dead).length===t.players.length-1&&t.started&&(t.winner=[0,1,2,3].filter((function(e){return!t.dead[e]}))[0]),t.dead[t.turn]?e(Oe(Object(u.a)(Object(u.a)({},t),{},{turn:t.turn}))):Object(u.a)(Object(u.a)({},t),{},{turn:t.turn})},je=function(e,t){console.log("poker99 reducer");var n=t.peerId;if(void 0===n)throw new Error("Expect peerId in action");switch(t.type){case H.START:return function(e){(e=Object(u.a)(Object(u.a)({},e),{},{drawDeck:[],trashDeck:[],playerDeck:[],points:0,direction:1,turn:0,dead:{},logs:["game started"],winner:void 0})).drawDeck=Z(function(){for(var e=[],t=0;t<4;t++)for(var n=1;n<=13;n++)e.push({suit:t,number:n});return e}());for(var t=0;t<e.players.length;t++){e.playerDeck[t]=[];for(var n=0;n<5;n++)e=we(t)(e)}return Object(u.a)({},e)}(e);case ce.PLAY_CARD:return function(e,t){return function(n){var r=t.card,a="".concat(ie[r.suit]).concat(r.number);if(void 0===n.playerDeck[e].find((function(e){var t=e.suit,n=e.number;return t===r.suit&&n===r.number})))throw new Error("".concat(n.players[e]," doesnt own card ").concat(a));if(n.turn!==e)throw new Error("not your turn");return X.apply(void 0,[we(e)].concat(Object(g.a)([ge,le,he,de,me,ve,ye,be].map((function(n){return n(t,e)})))))(n)}}(function(){var t=e.nameDict[e.members[n]];if(void 0===t)throw new Error("game not started");return t}(),t.payload)(P()(e));case ce.END:return Object(u.a)(Object(u.a)({},e),{},{started:!1})}return e},Ee=n(77),Ae=function(e){return[4,5,11,13].includes(e.number)},xe=function(e,t){var n=e.playerDeck[t],r=e.points,a=n.filter(fe).sort((function(e,t){return ue[t.number]-ue[e.number]}));console.log("normal cards",a,"points",r);var c=n.find((function(e){return 13===e.number}));if(void 0!==c&&99!==r&&a.length<3)return{type:ce.PLAY_CARD,payload:{card:c}};var i,o=Object(Ee.a)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(console.log("should play normal?",s,r+ue[s.number]<=99),r+ue[s.number]<=99)return{type:ce.PLAY_CARD,payload:{card:s}}}}catch(g){o.e(g)}finally{o.f()}var u,l=n.filter(pe),f=Object(Ee.a)(l.sort((function(e,t){return t.number-e.number})));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(r+ue[h.number]<=99)return{type:ce.PLAY_CARD,payload:{card:h,increase:!0}}}}catch(g){f.e(g)}finally{f.f()}var p=n.find(Ae);if(void 0!==p)return{type:ce.PLAY_CARD,payload:{card:p,target:e.nameDict[Z(e.players.filter((function(n,r){return!e.dead[r]&&r!==t})))[0]]}};var d,m=Object(Ee.a)(l.sort((function(e,t){return e.number-t.number})));try{for(m.s();!(d=m.n()).done;){var v=d.value;if(r-ue[v.number]<=99)return{type:ce.PLAY_CARD,payload:{card:v,increase:!1}}}}catch(g){m.e(g)}finally{m.f()}var y,b=Object(Ee.a)(n);try{for(b.s();!(y=b.n()).done;){var w=y.value;if(r-ue[w.number]<=99)return{type:ce.PLAY_CARD,payload:{card:w,increase:!1}}}}catch(g){b.e(g)}finally{b.f()}throw new Error("reached an edge case")},Se=Object(a.createContext)(null),Ce=function(){var e=Object(a.useContext)(Se);if(null===e)throw new Error("please wrap it using withPoker99Network before calling this hook");return e},Pe=n(6093),Le=n(6097),De=n(80),_e=n(6113),Ne=n(6099),Re=n(79),Te=function(){return Object(Re.d)({dictionaries:[Re.a,Re.c,Re.b],style:"capital",separator:" "})},Ie=function(){var e=Ce().connect,t=Object(a.useState)(Te()),n=Object(p.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(""),s=Object(p.a)(o,2),u=s[0],l=s[1],d=Object(a.useState)(""),m=Object(p.a)(d,2),v=m[0],y=m[1],b=function(){var t=Object(h.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(r,u).catch((function(e){return y(e.message)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return c.a.createElement(Pe.a,{elevation:3,style:{padding:"32px 64px"}},c.a.createElement(Le.a,{container:!0,justify:"flex-end",direction:"column",spacing:3},c.a.createElement(Le.a,{item:!0},c.a.createElement(De.a,{variant:"h5"},"Welcome to Poker 99")),""!==v&&c.a.createElement(Le.a,{item:!0},v),c.a.createElement(Le.a,{item:!0},c.a.createElement(_e.a,{label:"Your Name",value:r,onChange:function(e){var t=e.target.value;return i(t)},fullWidth:!0})),c.a.createElement(Le.a,{item:!0},c.a.createElement(_e.a,{label:"Room Code",value:u,onChange:function(e){var t=e.target.value;return l(t)},fullWidth:!0})),c.a.createElement(Le.a,{item:!0,container:!0,justify:"flex-end"},c.a.createElement(Ne.a,{color:"primary",variant:"contained",disabled:""===r||""===u,onClick:b},"join"))))},Me=n(38),He=n(6103),Ke=n(6104),Fe=n(6098),Be=n(6105),Ue=n(6106),We=n(6107),Ge=n(6108),Ye=n(6116),Je=n(6110),Ve=n(6111),ze=n(6112),qe=n(6100),Qe=n(6101),Xe=n(6102),Ze=n(6109),$e=n(96),et=n(62),tt=function(){return c.a.createElement(et.a,null,c.a.createElement("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},c.a.createElement("path",{d:"M11,4c1,0,1.7,0.8,1.7,1.7c0,0.6-0.3,1.2-0.9,1.5v1.1h0.9c3.3,0,6.1,2.7,6.1,6.1l0,0h0.9c0.5,0,0.9,0.4,0.9,0.9v2.6\r c0,0.5-0.4,0.9-0.9,0.9H19v0.9c0,1-0.8,1.7-1.7,1.7H5.1c-1,0-1.7-0.8-1.7-1.7v-0.9H2.5c-0.5,0-0.9-0.4-0.9-0.9v-2.6\r c0-0.5,0.4-0.9,0.9-0.9h0.9c0-3.3,2.7-6.1,6.1-6.1h0.9V7.2C9.8,7,9.5,6.4,9.5,5.8C9.5,4.8,10.2,4,11.2,4 M7.3,13.5\r c-1.2,0-2.2,1-2.2,2.2c0,1.2,1,2.2,2.2,2.2s2.2-1,2.2-2.2C9.5,14.5,8.5,13.5,7.3,13.5 M15.1,13.5c-1.2,0-2.2,1-2.2,2.2\r c0,1.2,1,2.2,2.2,2.2s2.2-1,2.2-2.2C17.2,14.5,16.3,13.5,15.1,13.5z"}),c.a.createElement("path",{d:"M17.9,1.8v3h-3v2h3v3h2v-3h3v-2h-3v-3H17.9z"})))},nt=function(){return c.a.createElement(et.a,null,c.a.createElement("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},c.a.createElement("path",{d:"M12,5.5c2.2,0,4,1.8,4,4s-1.8,4-4,4s-4-1.8-4-4S9.8,5.5,12,5.5 M12,7.5c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2\r S13.1,7.5,12,7.5 M12,14.5c2.7,0,8,1.3,8,4v3H4v-3C4,15.8,9.3,14.5,12,14.5 M12,16.4c-3,0-6.1,1.5-6.1,2.1v1.1h12.2v-1.1\r C18.1,17.9,15,16.4,12,16.4z"}),c.a.createElement("path",{d:"M17.9,1.8v3h-3v2h3v3h2v-3h3v-2h-3v-3H17.9z"})))},rt=n(6114),at=function(){var e=Ce(),t=e.room,n=e.state,r=e.leave,i=e.isAdmin,o=e.myId,s=e.kick,u=e.ready,l=e.start,d=e.addAi,m=e.addLocal,v=e.playerType,y=Object(a.useState)(""),b=Object(p.a)(y,2),w=b[0],g=b[1],O=Object(a.useState)(""),k=Object(p.a)(O,2),j=k[0],E=k[1],A=Object(a.useState)(void 0),x=Object(p.a)(A,2),S=x[0],C=x[1],P=Object(Me.a)(),L=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l().catch((function(e){return g(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().catch((function(e){return g(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(Te()).catch((function(e){return g(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){E(""),C(void 0)},R=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===j){e.next=9;break}if(!0!==S){e.next=6;break}return e.next=4,m(j).catch((function(e){return g(e.message)}));case 4:e.next=9;break;case 6:if(!1!==S){e.next=9;break}return e.next=9,d(j).catch((function(e){return g(e.message)}));case 9:N();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(e,t){return e===n.networkName?"".concat(t," is the host"):e in n.spectators?"".concat(t," is a spectator"):e in n.localPlayers?"".concat(t," is a local player of ").concat(n.members[n.localPlayers[e]]):e in n.aiPlayers?"".concat(t," is an ai player of ").concat(n.members[n.aiPlayers[e]]):n.ready[e]?"".concat(t," is not ready yet"):"".concat(t," is ready")};return c.a.createElement(Pe.a,{elevation:3,style:{padding:"32px 64px",minWidth:"400px"}},c.a.createElement(Le.a,{container:!0,justify:"flex-end",direction:"column",spacing:3},c.a.createElement(Le.a,{item:!0},c.a.createElement(De.a,{variant:"h5"},"Room: ",t)),c.a.createElement(Le.a,{item:!0},c.a.createElement(Le.a,{container:!0,justify:"space-between",alignItems:"flex-end"},c.a.createElement(Le.a,{item:!0},c.a.createElement(De.a,{variant:"h6"},"Players")),c.a.createElement(Le.a,{item:!0},c.a.createElement(He.a,{size:"medium",title:"Add Local Hot Seat player",onClick:function(){return C(!0)}},c.a.createElement(nt,null)),c.a.createElement(He.a,{size:"medium",title:"Add AI Player",onClick:_},c.a.createElement(tt,null)))),c.a.createElement(Ke.a,null),c.a.createElement(Fe.a,null,Object.entries(n.members).map((function(e){var t=Object(p.a)(e,2),r=t[0],a=t[1],u=r===n.networkName||[K.LOCAL,K.AI].includes(v(a))?P.palette.primary.main:n.ready[r]?P.palette.success.main:P.palette.text.secondary;return c.a.createElement(Be.a,{key:r,title:T(r,a),style:{color:u}},c.a.createElement(Ue.a,null,c.a.createElement("span",{style:{color:u}},function(e,t){return e in n.spectators?c.a.createElement(Le.a,{item:!0,title:"spectator"},c.a.createElement(qe.a,null)):n.networkName===e?c.a.createElement(Le.a,{item:!0,title:"host"},c.a.createElement($e.b,null)):v(t)===K.NORMAL?n.ready[e]?c.a.createElement(Le.a,{item:!0,title:"player ready"},c.a.createElement($e.a,null)):c.a.createElement(Le.a,{item:!0,title:"player not ready"},c.a.createElement(Qe.a,null)):v(t)===K.LOCAL?c.a.createElement(Le.a,{item:!0,title:"hot seat player"},c.a.createElement(Xe.a,null)):v(t)===K.AI?c.a.createElement(Le.a,{item:!0,title:"AI player"},c.a.createElement($e.c,null)):void 0}(r,a))),c.a.createElement(We.a,null,a),(i||[K.LOCAL,K.AI].includes(v(a)))&&r!==o&&r!==n.networkName&&c.a.createElement(Ge.a,null,c.a.createElement(He.a,{edge:"end","aria-label":"delete",onClick:function(){return s(r)},title:"Kick"},c.a.createElement(Ze.a,{color:"error"}))))})))),""!==w&&c.a.createElement(rt.a,{severity:"error"},w),c.a.createElement(Le.a,{item:!0,container:!0,justify:"flex-end",spacing:1},c.a.createElement(Le.a,{item:!0},c.a.createElement(Ne.a,{variant:"contained",color:"secondary",onClick:r},"leave")),c.a.createElement(Le.a,{item:!0},i?c.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:L},"start"):c.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:D},n.ready[null!==o&&void 0!==o?o:""]?"unready":"ready")))),c.a.createElement(Ye.a,{open:void 0!==S,onClose:N,"aria-labelledby":"form-dialog-title"},c.a.createElement(Je.a,{id:"form-dialog-title"},"Name for new ",!0===S?"local":"AI"," player"),c.a.createElement(Ve.a,null,c.a.createElement(_e.a,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,value:j,onChange:function(e){var t=e.target;return E(t.value)}})),c.a.createElement(ze.a,null,c.a.createElement(Ne.a,{onClick:N,color:"primary"},"Cancel"),c.a.createElement(Ne.a,{onClick:R,color:"primary"},"Create"))))},ct=function(){var e=Ce(),t=e.state,n=e.dispatch,r=e.dispatchAs,i=e.myPlayerId,o=e.myLocals,s=e.hideDeck,u=e.setHideDeck,l=e.error,d=e.setError,m=e.renderedDeckId,v=Object(a.useState)(0),y=Object(p.a)(v,2),b=y[0],w=y[1],g=Object(a.useState)(!0),O=Object(p.a)(g,2),k=O[0],j=O[1],E=1===t.direction?">":"<",A=function(e){d(e.message)},x=function(e){return Object(h.a)(f.a.mark((function a(){var c;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c={type:ce.PLAY_CARD,payload:{card:e,increase:k,target:b}},t.turn!==i){a.next=6;break}return a.next=4,n(c).then((function(){return d("")})).catch(A);case 4:a.next=9;break;case 6:if(!o.includes(t.players[t.turn])){a.next=9;break}return a.next=9,r(t.turn,c).then((function(){return d("")})).catch(A);case 9:case"end":return a.stop()}}),a)})))},S=function(e){var n;return null===(n=t.playerDeck[e])||void 0===n?void 0:n.map((function(e){return c.a.createElement("button",{key:10*e.number+e.suit,onClick:x(e)},ie[e.suit]," ",e.number)}))},C=function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({type:ce.END}).catch(A);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("div",{style:{pointerEvents:"all"}},c.a.createElement("div",null,c.a.createElement("h3",null,t.points),c.a.createElement("h6",null,t.players[t.turn],"'","s turn"),""!==l&&c.a.createElement("div",{style:{color:"red"}},l),void 0!==t.winner&&null!==t.winner&&c.a.createElement("div",null,"winner is ",t.players[t.winner],c.a.createElement("button",{onClick:C},"again")),t.players.map((function(e,n){return c.a.createElement("span",{key:e,onClick:function(){return w(n)},style:{fontWeight:t.turn===n?"bold":"normal",textDecorationLine:t.dead[n]?"line-through":"none"}},e," ",E)})),c.a.createElement("div",null,0===o.length?S(i):s?c.a.createElement("button",{onClick:function(){return u(!1)}},"show ",t.players[m]):S(m)),c.a.createElement("div",null,"target: ",b),c.a.createElement("button",{onClick:function(){return j(!k)}},k?"+":"-")),c.a.createElement("div",null,t.logs.slice().reverse().map((function(e,t){return c.a.createElement("div",{key:t},e)}))))},it=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ease";return{transition:t.map((function(t){return"".concat(e,"s ").concat(t," ").concat(n)})).join(",")}},ot=function(e){var t=function(t){var n=function(e,t,n){var r=oe(function(e){return function(t,n){return e(t,n)}}(e),t),c=r.myLocals,i=r.myPlayerId,o=r.myAis,s=r.dispatchAs,l=r.state,f=Object(a.useState)(""),h=Object(p.a)(f,2),d=h[0],m=h[1],v=Object(a.useState)(c.length>0),y=Object(p.a)(v,2),b=y[0],w=y[1],g=Object(a.useState)(i),O=Object(p.a)(g,2),k=O[0],j=O[1],E=Object(a.useRef)(-1);l.turn!==E.current&&(c.length>0&&(b=!0,w(!0),j(l.turn)),E.current=l.turn);var A=function(e){m(e.message)};return Object(a.useEffect)((function(){if(o.includes(l.players[l.turn])&&l.started&&void 0===l.winner){var e=window.setTimeout((function(){var e=n(l,l.turn);s(l.turn,e).catch(A)}),500);return function(){window.clearTimeout(e)}}}),[l]),Object(u.a)(Object(u.a)({},r),{},{state:l,hideDeck:b,setHideDeck:w,error:d,setError:m,renderedDeckId:k})}(je,new se,xe);return c.a.createElement(Se.Provider,{value:n},c.a.createElement(e,t))};return t.displayName="WithGameNetwork",t}((function(){var e=Ce().gameAppState;return c.a.createElement("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"relative"}},c.a.createElement("div",{style:Object(u.a)({pointerEvents:"none",display:"flex",height:"100vh",width:"100vw",left:"".concat(100*-(e-2),"%"),position:"absolute"},it(.3,["left"],"linear"))},c.a.createElement(ct,null)),c.a.createElement("div",{style:Object(u.a)({display:"flex",width:"100vw",height:"100vh",left:"".concat(100*-(e-1),"%"),justifyContent:"center",alignItems:"center",position:"absolute"},it(.3,["left"],"linear"))},c.a.createElement(at,null)),c.a.createElement("div",{style:Object(u.a)({display:"flex",width:"100vw",height:"100vh",left:"".concat(100*-e,"%"),justifyContent:"center",alignItems:"center",position:"absolute"},it(.3,["left"],"linear"))},c.a.createElement(Ie,null)))}));o.a.render(c.a.createElement(ot,null),document.getElementById("root")),s()}},[[5953,1,2]]]);
//# sourceMappingURL=main.527fbe65.chunk.js.map