/*! For license information please see main.0bdd6fea.chunk.js.LICENSE.txt */
(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[0],{5943:function(e,t,n){e.exports=n(6053)},5948:function(e,t,n){},5950:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=5950},5955:function(e,t){},5957:function(e,t){},5967:function(e,t){},5969:function(e,t){},5996:function(e,t){},5997:function(e,t){},6002:function(e,t){},6004:function(e,t){},6028:function(e,t){},6053:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(11),o=n.n(a),c=(n(5948),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,6113)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),a(e),o(e)}))}),s=n(62),u=n.n(s),l=n(107),f=n(109),h=n(176),d=n.n(h),p=n(63),y=n.n(p),m=n(6110),v=n(46),g=n.n(v),b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function w(e,t){function n(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var E,O=function(){return(O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function A(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function S(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{s(r.next(e))}catch(t){a(t)}}function c(e){try{s(r.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((r=r.apply(e,t||[])).next())}))}function k(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}!function(e){e.DISPATCH="DISPATCH",e.ACK="ACK",e.NACK="NACK",e.PROMOTE="PROMOTE",e.CANCEL="CANCEL",e.SET_STATE="SET_STATE",e.ASK_STATE="ASK_STATE",e.KICK="KICK"}(E||(E={}));var P,C=function(){function e(e){var t;if(void 0!==e)this._options=e;else{var n='{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}';this._options={host:null!==(t="peer.hkustracing.com")?t:"localhost",port:Number.parseInt(null!=="443"?"443":"9000",10),path:null!=="/"?"/":"/peer",secure:!0,config:JSON.parse(n)}}}return e.prototype.make=function(e){return new d.a(e,this._options)},e.prototype.makeAndOpen=function(e){return S(this,void 0,void 0,(function(){var t;return k(this,(function(n){switch(n.label){case 0:return t=this.make(e),[4,new Promise((function(e,n){t.on("open",(function(){e(t)})),t.on("error",(function(){n(t)}))}))];case 1:return[2,n.sent()]}}))}))},e}(),j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.message="already joined network",t.name="AlreadyJoinedNetworkError",t}return w(t,e),t}(Error),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.message="already connecting to network",t.name="AlreadyConnectingError",t}return w(t,e),t}(Error),L=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.message="player name already exist",t.name="PlayerNameAlreadyExistError",t}w(t,e)}(Error),function(e){function t(t){var n=e.call(this)||this;return n.name="PlayerNameAlreadyExistError",n.message="not connected to "+t,n}return w(t,e),t}(Error)),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.message="No Staging State",t.name="NoStagingStateError",t}return w(t,e),t}(Error),R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.message="Network is busy, please retry later",t.name="NetworkBusyError",t}return w(t,e),t}(Error);!function(e){e[e.ALL=0]="ALL",e[e.TRACE=1]="TRACE",e[e.LOG=2]="LOG",e[e.DEBUG=3]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=5]="WARN",e[e.ERROR=6]="ERROR",e[e.OFF=7]="OFF"}(P||(P={}));var N=function(){function e(e,t,n){var r=this;this._logs=[],this.pushLog=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];r._logs.length>=r._keep&&r._logs.shift(),r._logs.push({level:e,message:n,date:new Date})},this.getLogFunction=function(e){if(e<r._verboseLevel)return function(){};switch(e){case P.INFO:return console.info.bind(window.console);case P.LOG:case P.DEBUG:return console.log.bind(window.console);case P.ERROR:return console.error.bind(window.console);case P.WARN:return console.warn.bind(window.console);case P.TRACE:return console.trace.bind(window.console);default:return function(){}}},this.withColor=function(e,t){return function(n){var r,i=(r={},r[P.INFO]="color: DodgerBlue",r[P.LOG]="",r[P.DEBUG]="color: Green",r[P.ERROR]="",r[P.WARN]="",r[P.TRACE]="color: Green",r[P.ALL]="",r[P.OFF]="",r)[e],a=void 0===t?"%c["+P[e]+"]":"%c["+t.toISOString()+" "+P[e]+"]";return Function.prototype.bind.call(n,console,a,i)}},this.withHistoryButWrongLineNumber=function(e){return function(t){return new Proxy(t,{apply:function(t,n,i){var a=new Date;return r.pushLog.apply(r,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,c=a.length;o<c;o++,i++)r[i]=a[o];return r}([e,a],i)),t.apply(void 0,i)}})}},this.withAllFeatures=function(e){return e>=r._historyLevel?r.withHistoryButWrongLineNumber(e)(r.withColor(e)(r.getLogFunction(e))):r.withColor(e)(r.getLogFunction(e))},this.clear=function(){r._logs.splice(0,r._logs.length)},this.printLogs=function(){r._logs.forEach((function(e){var t=e.level,n=e.message,i=e.date;r.withColor(t,i)(r.getLogFunction(t)).apply(void 0,n)}))},this.getLogs=function(e){return void 0===e&&(e=P.ALL),r._logs.filter((function(t){return t.level>=e}))},this._historyLevel=e,this._verboseLevel=t,this._keep=n}return Object.defineProperty(e.prototype,"historyLevel",{set:function(e){this._historyLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verboseLevel",{set:function(e){this._verboseLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keep",{set:function(e){this._keep=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return this.withAllFeatures(P.INFO)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"log",{get:function(){return this.withAllFeatures(P.LOG)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this.withAllFeatures(P.DEBUG)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.withAllFeatures(P.ERROR)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"warn",{get:function(){return this.withAllFeatures(P.WARN)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trace",{get:function(){return this.withAllFeatures(P.TRACE)},enumerable:!1,configurable:!0}),e}(),T=new N(P.ALL,P.WARN,100);T.historyLevel=P.OFF,T.verboseLevel=P.ALL;var I=function(){function e(e,t){this.isAdmin=!0,this.leaving=!1,this.network=e,this.peerFactory=t}return e.prototype.handlePromote=function(e){return S(this,void 0,void 0,(function(){var t;return k(this,(function(n){switch(n.label){case 0:if(void 0===this.stagingState)throw T.error("Cannot promote, there is no staging state"),new D;if((t=y()(JSON.stringify(this.stagingState)))!==e)throw T.error("Cannot promote, staging checksum is "+t+" while requested to promote checksum of "+e),new Error("Cannot promote staging state with unmatched checksum");return this.network.setState(this.stagingState),T.info("promoted the stagingState",this.stagingState),this.stagingState=void 0,[4,Promise.resolve()];case 1:return[2,n.sent()]}}))}))},e.prototype.handleCancel=function(e){return S(this,void 0,void 0,(function(){var t;return k(this,(function(n){switch(n.label){case 0:if(void 0===this.stagingState)throw T.error("Cannot cancel, there is no staging state"),new D;if((t=y()(JSON.stringify(this.stagingState)))!==e)throw T.error("Cannot cancel, staging checksum is "+t+" while requested to cancel checksum of "+e),new Error("Cannot cancel staging state with unmatched checksum");return T.info("canceled the stagingState",this.stagingState),this.stagingState=void 0,[4,Promise.resolve()];case 1:return[2,n.sent()]}}))}))},e.prototype.forceCancel=function(){T.info("force cancel the stagingState"),this.stagingState=void 0},e.prototype.isBusy=function(){return void 0!==this.stagingState},e}(),x=function(e){return S(void 0,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){setTimeout((function(){t()}),e)}))];case 1:return[2,t.sent()]}}))}))},M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return w(t,e),t.prototype.dispatch=function(e){return S(this,void 0,void 0,(function(){var t,n,r,i,a,o=this;return k(this,(function(c){switch(c.label){case 0:return T.debug("reduce locally",this.network.getState(),e),this.stagingState=this.network.applyReducer(this.network.getState(),e),t=y()(JSON.stringify(this.stagingState)),T.debug("stagingState",this.stagingState),[4,this.network.broadcast(E.DISPATCH,e)];case 1:return n=c.sent(),T.debug("obtained responses",n),r=[],i=[],a=[],n.forEach((function(e){var n=e.conn,o=e.data,c=e.error;void 0!==c?r.push({error:c,conn:n}):o!==t?i.push(n):a.push(n)})),a.length===n.length?T.debug("all can be promoted"):(r.length>0&&T.error("received "+r.length+" error from some peers",r),i.length>0&&T.warn("received "+i.length+" unmatched checksum from some peer, forceUpdating them",i)),r.length>0?[4,this.network.broadcast(E.CANCEL,t)]:[3,3];case 2:throw c.sent(),new Error(r[0].error);case 3:i.map((function(e){return S(o,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this.network.send(e,E.SET_STATE,this.stagingState)];case 1:return t.sent(),[2]}}))}))})),a.map((function(e){return S(o,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return[4,this.network.send(e,E.PROMOTE,t)];case 1:return n.sent(),[2]}}))}))})),c.label=4;case 4:return[4,this.handlePromote(t)];case 5:return c.sent(),[2]}}))}))},t.prototype.handleDispatch=function(e,t){return S(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return[4,this.dispatch(t)];case 1:return e.sent(),[2,this.network.getState()]}}))}))},t.prototype.setUpConnection=function(e){var t=this;e.on("close",(function(){t.dispatchMemberLeft(e.peer).catch(T.error)}))},t.prototype.dispatchMemberLeft=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:if(this.leaving)return[3,6];t.label=1;case 1:return t.trys.push([1,3,,6]),[4,this.network.dispatch({type:"member-left",payload:e})];case 2:return t.sent(),[3,6];case 3:return t.sent(),[4,x(1e3)];case 4:return t.sent(),[4,this.dispatchMemberLeft(e)];case 5:return t.sent(),[3,6];case 6:return[2]}}))}))},t}(I),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isAdmin=!1,t}return w(t,e),t.prototype.dispatch=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this.network.broadcast(E.DISPATCH,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.handleDispatch=function(e,t){return S(this,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return this.stagingState=this.network.applyReducer(e,t),[4,Promise.resolve(this.stagingState)];case 1:return[2,n.sent()]}}))}))},t.prototype.setUpConnection=function(e){var t=this;e.on("close",(function(){t.leaving||t.recover().catch(T.error)}))},t.prototype.recover=function(){return S(this,void 0,void 0,(function(){var e,t;return k(this,(function(n){switch(n.label){case 0:if(void 0===(e=this.network.getNetworkName()))return[3,7];n.label=1;case 1:return n.trys.push([1,5,,7]),t=this.network.myId,T.debug("oldId",t),[4,this.network.initAsStarHost(e,this.peerFactory)];case 2:return n.sent(),T.info("became the new host, changed peerId, notify others"),void 0===t?[3,4]:[4,this.dispatchHostLeft(t)];case 3:n.sent(),n.label=4;case 4:return[3,7];case 5:return n.sent(),[4,this.network.reconnectToHost(e)];case 6:return n.sent(),[3,7];case 7:return[2]}}))}))},t.prototype.dispatchHostLeft=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,5]),[4,this.network.dispatch({type:"host-left",payload:e})];case 1:return t.sent(),[3,5];case 2:return t.sent(),[4,x(1e3)];case 3:return t.sent(),[4,this.dispatchHostLeft(e)];case 4:return t.sent(),[3,5];case 5:return[2]}}))}))},t}(I),K=function(){function e(){this.connections={},this.sentPromises={}}return e.prototype.reset=function(){this.connections={}},e.prototype.registerConnection=function(e){this.connections[e.peer]=e},e.prototype.unregisterConnection=function(e){var t=this.connections,n=e.peer,r=(t[n],A(t,["symbol"===typeof n?n:n+""]));this.connections=r},e.prototype.getConnections=function(){return this.connections},e.prototype.send=function(e,t,n){return S(this,void 0,void 0,(function(){var r,i=this;return k(this,(function(a){switch(a.label){case 0:return r=this.getConn(e),[4,new Promise((function(e,a){var o=Object(m.a)();i.sentPromises[o]={resolve:function(t){return e({conn:r,data:t})},reject:function(e){return a(new Error(e))}},r.send({pkgType:t,data:n,pid:o})}))];case 1:return[2,a.sent()]}}))}))},e.prototype.sendACK=function(e,t,n){this.getConn(e).send({pkgType:E.ACK,pid:t,data:n})},e.prototype.sendNACK=function(e,t,n){this.getConn(e).send({pkgType:E.NACK,pid:t,data:n})},e.prototype.broadcast=function(e,t){return S(this,void 0,void 0,(function(){var n,r=this;return k(this,(function(i){switch(i.label){case 0:return n=Object.keys(this.connections).map((function(n){return S(r,void 0,void 0,(function(){return k(this,(function(r){switch(r.label){case 0:return[4,this.send(n,e,t)];case 1:return[2,r.sent()]}}))}))})),[4,Promise.all(n)];case 1:return[2,i.sent()]}}))}))},e.prototype.receiveACK=function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].resolve)(t),this.removeSentPromise(e))},e.prototype.receiveNACK=function(e,t){void 0!==e&&e in this.sentPromises&&((0,this.sentPromises[e].reject)(t),this.removeSentPromise(e))},e.prototype.removeSentPromise=function(e){var t=this.sentPromises,n=e,r=(t[n],A(t,["symbol"===typeof n?n:n+""]));this.sentPromises=r},e.prototype.getConn=function(e){if("string"===typeof e){var t=this.connections[e];if(void 0!==t)return t;throw new L(e)}return e},e}(),F=function(){function e(e,t,n){var r=this;void 0===n&&(n=0),this.history=[],this.historyMax=n,this.initialState=g()(e),this._reset=function(){return r.set(g()(r.initialState))},this.state=e,this._set=null!==t&&void 0!==t?t:function(e){r.state=e}}return e.prototype.get=function(){return this.state},e.prototype.set=function(e){this.state=e,this.historyMax>0&&(this.history.length>=this.historyMax&&this.history.shift(),this.history.push(g()(e))),this._set(O({},e))},e.prototype.reset=function(){this._reset()},e.prototype.getHistory=function(){return this.history},e.make=function(t,n,r){return new e(t,n,r)},e}(),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return w(t,e),t.prototype.dispatch=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:if(void 0!==this.stagingState)throw T.error("cannot dispatch when there is staging state",this.stagingState),new R;return[4,this.wrappedStrategy.dispatch(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.handleDispatch=function(e,t){return S(this,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:if(void 0!==this.stagingState)throw T.error("cannot handle dispatch request when there is staging state",this.stagingState),new R;return[4,this.wrappedStrategy.handleDispatch(e,t)];case 1:return[2,n.sent()]}}))}))},t}(function(){function e(e){this.wrappedStrategy=e}return Object.defineProperty(e.prototype,"stagingState",{get:function(){return this.wrappedStrategy.stagingState},set:function(e){this.wrappedStrategy.stagingState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"network",{get:function(){return this.wrappedStrategy.network},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaving",{get:function(){return this.wrappedStrategy.leaving},set:function(e){this.wrappedStrategy.leaving=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAdmin",{get:function(){return this.wrappedStrategy.isAdmin},set:function(e){this.wrappedStrategy.isAdmin=e},enumerable:!1,configurable:!0}),e.prototype.dispatch=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this.wrappedStrategy.dispatch(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.forceCancel=function(){return this.wrappedStrategy.forceCancel()},e.prototype.handleCancel=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this.wrappedStrategy.handleCancel(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.handleDispatch=function(e,t){return S(this,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return[4,this.wrappedStrategy.handleDispatch(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.handlePromote=function(e){return S(this,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return[4,this.wrappedStrategy.handlePromote(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.isBusy=function(){return this.wrappedStrategy.isBusy()},e.prototype.setUpConnection=function(e){return this.wrappedStrategy.setUpConnection(e)},e}()),G=function(e){return new B(e)},U=function(){function e(e,t){var n=this;this.dataStream=new K,this._connecting=!1,this._dispatching=!1,this.getHistory=function(){return n.stateManager.getHistory()},this.kick=function(e){return S(n,void 0,void 0,(function(){var t,n;return k(this,(function(r){switch(r.label){case 0:return null!==(n=null===(t=this.getNeighbor())||void 0===t?void 0:t.includes(e))&&void 0!==n&&n?[4,this.send(e,E.KICK,e)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this.broadcast(E.KICK,e)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},this.stateManager=t instanceof F?t:F.make(t),this.stateReducer=e}return Object.defineProperty(e.prototype,"myId",{get:function(){var e;return null===(e=this.peer)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return void 0!==this.networkName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connecting",{get:function(){return this._connecting},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dispatching",{get:function(){return this._dispatching},enumerable:!1,configurable:!0}),e.prototype.getNetworkName=function(){return this.networkName},e.prototype.setState=function(e){this.stateManager.set(e)},e.prototype.getState=function(){return this.stateManager.get()},Object.defineProperty(e.prototype,"state",{get:function(){return this.getState()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAdmin",{get:function(){var e,t;return null!==(t=null===(e=this.networkStrategy)||void 0===e?void 0:e.isAdmin)&&void 0!==t&&t},enumerable:!1,configurable:!0}),e.prototype.applyReducer=function(e,t){return this.stateReducer(e,t)},e.prototype.reduce=function(e){this.stateManager.set(this.stateReducer(this.stateManager.get(),e))},e.prototype.leave=function(){return S(this,void 0,void 0,(function(){var e,t=this;return k(this,(function(n){switch(n.label){case 0:return void 0===this.peer?[3,2]:(void 0!==this.networkStrategy&&(this.networkStrategy.leaving=!0),e=new Promise((function(e){var n;return null===(n=t.peer)||void 0===n?void 0:n.on("close",e)})),this.peer.destroy(),[4,e]);case 1:n.sent(),this.peer=void 0,this.networkName=void 0,this.dataStream.reset(),this.stateManager.reset(),n.label=2;case 2:return[2]}}))}))},e.prototype.join=function(e,t){return S(this,void 0,void 0,(function(){var n;return k(this,(function(r){switch(r.label){case 0:if(void 0!==this.peer)throw new j;if(this._connecting)throw new _;this._connecting=!0,r.label=1;case 1:r.trys.push([1,8,,9]),t=null!==t&&void 0!==t?t:new C,r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.initAsStarHost(e,t)];case 3:return r.sent(),this.stateManager.reset(),this.setState(O(O({},this.getState()),{networkName:e})),[3,6];case 4:return r.sent(),T.info("cannot init as host, try to init as member"),[4,this.initAsStarMember(e,t)];case 5:return r.sent(),[3,6];case 6:return[4,this.dispatch({type:"member-join"})];case 7:return r.sent(),this._connecting=!1,[3,9];case 8:throw n=r.sent(),this._connecting=!1,n;case 9:return[2]}}))}))},e.prototype.initAsStarHost=function(e,t){return S(this,void 0,void 0,(function(){var n,r,i=this;return k(this,(function(a){switch(a.label){case 0:return T.info("initing as host"),n=this.peer,r=this,[4,t.makeAndOpen(e)];case 1:return r.peer=a.sent(),this.peer.on("connection",(function(e){T.info("received connection with",e.peer),i.setUpConnection(e)})),this.networkName=e,this.networkStrategy=G(new M(this,t)),null===n||void 0===n||n.destroy(),T.info("inited as host"),[2]}}))}))},e.prototype.initAsStarMember=function(e,t){return S(this,void 0,void 0,(function(){var n;return k(this,(function(r){switch(r.label){case 0:return T.info("initing as member"),this.networkStrategy=G(new H(this,t)),n=this,[4,t.makeAndOpen()];case 1:return n.peer=r.sent(),T.info("opened peer"),[4,this.reconnectToHost(e)];case 2:return r.sent(),[2]}}))}))},e.prototype.reconnectToHost=function(e){return S(this,void 0,void 0,(function(){var t,n;return k(this,(function(r){switch(r.label){case 0:return void 0===this.peer?[2]:(t=this.peer.connect(e),this.setUpConnection(t),[4,new Promise((function(e,n){t.on("open",(function(){e()})),t.on("error",(function(e){n(e)}))}))]);case 1:return r.sent(),T.info("opened connection with host"),this.dataStream.registerConnection(t),this.networkName=e,T.info("requesting state from host"),[4,this.dataStream.send(e,E.ASK_STATE,void 0)];case 2:return void 0!==(n=r.sent().data)&&(T.info("updating the state got from host",n),this.setState(n)),T.info("inited as member"),[2]}}))}))},e.prototype.getNeighbor=function(){if(void 0!==this.peer)return Object.keys(this.dataStream.getConnections())},e.prototype.send=function(e,t,n){return S(this,void 0,void 0,(function(){return k(this,(function(r){switch(r.label){case 0:return[4,this.dataStream.send(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.broadcast=function(e,t){return S(this,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return[4,this.dataStream.broadcast(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.dispatch=function(e){var t,n;return S(this,void 0,void 0,(function(){var r;return k(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),this._dispatching=!0,e.peerId=null!==(t=e.peerId)&&void 0!==t?t:this.myId,void 0===this.myId||null===this.myId?[3,2]:(T.info("dispatching action",e),[4,null===(n=this.networkStrategy)||void 0===n?void 0:n.dispatch(e)]);case 1:return i.sent(),T.info("dispatched action",e),[3,3];case 2:T.error("not connected"),i.label=3;case 3:return this._dispatching=!1,[3,5];case 4:throw r=i.sent(),this._dispatching=!1,r;case 5:return[2]}}))}))},e.prototype.setUpConnection=function(e){var t,n=this;e.on("open",(function(){T.info("opened connection with",e.peer),n.dataStream.registerConnection(e)})),e.on("close",(function(){T.info("closed connection with",e.peer),n.dataStream.unregisterConnection(e)})),e.on("data",(function(t){return n.dataHandler(t,e)})),null===(t=this.networkStrategy)||void 0===t||t.setUpConnection(e)},e.prototype.dataHandler=function(e,t){var n,r,i,a,o=this,c=e.pid,s=e.pkgType,u=e.data;switch(T.debug("received pkg from",t.peer,e),s){case E.DISPATCH:null===(n=this.networkStrategy)||void 0===n||n.handleDispatch(this.getState(),u).then((function(e){var n=y()(JSON.stringify(e));o.dataStream.sendACK(t,c,n)})).catch((function(e){o.dataStream.sendNACK(t,c,e.message)}));break;case E.ACK:this.dataStream.receiveACK(c,u);break;case E.NACK:this.dataStream.receiveNACK(c,u);break;case E.PROMOTE:null===(r=this.networkStrategy)||void 0===r||r.handlePromote(u).then((function(){return o.dataStream.sendACK(t,c,u)})).catch((function(e){return o.dataStream.sendNACK(t,c,e.message)}));break;case E.CANCEL:null===(i=this.networkStrategy)||void 0===i||i.handleCancel(u).then((function(){return o.dataStream.sendACK(t,c,u)})).catch((function(e){return o.dataStream.sendNACK(t,c,e.message)}));break;case E.SET_STATE:this.setState(u),null===(a=this.networkStrategy)||void 0===a||a.forceCancel();break;case E.ASK_STATE:this.dataStream.sendACK(t,c,this.state);break;case E.KICK:u===this.myId?(T.info("you got kicked out of network"),this.leave().catch(T.error)):this.send(u,s,u).catch(T.error)}},e}();var W,Y,q=n(108);!function(e){e.MEMBER_JOIN="member-join",e.MEMBER_LEFT="member-left",e.HOST_LEFT="host-left",e.RENAME="rename",e.READY="ready",e.START="start",e.ADD_AI="add-ai",e.ADD_LOCAL="add-local",e.REMOVE_LOCAL_AI="remove-local-ai"}(W||(W={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LOCAL=1]="LOCAL",e[e.AI=2]="AI"}(Y||(Y={}));var z=function(){this.minPlayer=1,this.maxPlayer=4,this.members={},this.spectators={},this.localPlayers={},this.aiPlayers={},this.nameDict={},this.players=[],this.ready={},this.started=!1},J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var V=function(){return(V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Q(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function X(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{s(r.next(e))}catch(t){a(t)}}function c(e){try{s(r.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((r=r.apply(e,t||[])).next())}))}function Z(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var $,ee=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reverse().reduce((function(e,t){return t(e)}),t)}},te=function(e){for(var t,n=e.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1));t=[e[r],e[n]],e[n]=t[0],e[r]=t[1]}return e},ne=function(e){return function(t){var n;if(e in t.members)throw new Error("peerId "+e+" already joined this room");return(t.maxPlayer>0&&Object.values(t.members).length>=t.maxPlayer||t.started)&&(t.spectators[e]=!0),V(V({},t),{members:V(V({},t.members),(n={},n[e]="",n))})}},re=function(e,t){return function(n){var r;if(Object.values(n.members).includes(t))throw new Error("there is already someone named "+t);if(n.started&&Object.keys(n.nameDict).includes(t)){var i=n.spectators,a=e,o=(i[a],Q(i,["symbol"===typeof a?a:a+""]));n.spectators=o}return V(V({},n),{members:V(V({},n.members),(r={},r[e]=t,r))})}},ie=function(e,t){return function(n){var r={},i={};return Object.entries(n.localPlayers).forEach((function(n){var i=n[0],a=n[1];a!==e?r[i]=a:void 0!==t&&(r[i]=t)})),Object.entries(n.aiPlayers).forEach((function(n){var r=n[0],a=n[1];a!==e?i[r]=a:void 0!==t&&(i[r]=t)})),V(V({},n),{localPlayers:r,aiPlayers:i})}},ae=function(e){return function(t){var n=t.members,r=e,i=(n[r],Q(n,["symbol"===typeof r?r:r+""])),a=t.localPlayers,o=e,c=(a[o],Q(a,["symbol"===typeof o?o:o+""])),s=t.aiPlayers,u=e,l=(s[u],Q(s,["symbol"===typeof u?u:u+""]));return V(V({},t),{members:i,localPlayers:c,aiPlayers:l})}},oe=function(e){return function(t){if(t.started)throw new Error("Started already");var n=Object.keys(t.members).filter((function(t){return t!==e})).filter((function(e){return!t.spectators[e]})).filter((function(e){return void 0===t.localPlayers[e]})).filter((function(e){return void 0===t.aiPlayers[e]})).filter((function(e){var n;return void 0!==e&&!(null!==(n=t.ready[e])&&void 0!==n&&n)}));if(0===n.length)return function(e){var t=te(Object.entries(e.members).filter((function(t){var n=t[0];return!e.spectators[n]})).map((function(e){return e[1]})));if(t.length>e.maxPlayer)throw new Error("Too much players, max: "+e.maxPlayer+", got: "+t.length);if(t.length<e.minPlayer)throw new Error("Not enough players, min: "+e.minPlayer+", got: "+t.length);var n={};return t.forEach((function(e,t){n[e]=t})),V(V({},e),{nameDict:n,players:t})}(V(V({},t),{started:!0}));throw new Error(n.map((function(e){return t.members[e]})).join(",")+" not ready yet")}},ce=function(e,t){var n=t.peerId;if(void 0===n)throw new Error("expect peerId in action");var r,i,a=e.networkName;if(void 0===a)throw new Error("expect networkName in prevState");switch(t.type){case W.MEMBER_JOIN:return ne(n)(e);case W.RENAME:return re(n,t.payload)(e);case W.MEMBER_LEFT:return ee(ie(t.payload,a),ae(t.payload))(e);case W.HOST_LEFT:return ee(ie(t.payload,a),re(a,e.members[t.payload]),ae(t.payload))(e);case W.READY:return function(e){return function(t){var n;if(t.ready[e]){var r=t.ready,i=e,a=(r[i],Q(r,["symbol"===typeof i?i:i+""]));return V(V({},t),{ready:a})}return V(V({},t),{ready:V(V({},t.ready),(n={},n[e]=!0,n))})}}(n)(e);case W.START:return oe(a)(e);case W.ADD_AI:return(r=t.payload,i=n,function(e){var t,n="ai-"+r+"-"+Object(q.v4)(),a=ee(re(n,r),ne(n))(e);return V(V({},a),{aiPlayers:V(V({},a.aiPlayers),(t={},t[n]=i,t))})})(e);case W.ADD_LOCAL:return function(e,t){return function(n){var r,i="local-"+e+"-"+Object(q.v4)(),a=ee(re(i,e),ne(i))(n);return V(V({},a),{localPlayers:V(V({},a.localPlayers),(r={},r[i]=t,r))})}}(t.payload,n)(e);case W.REMOVE_LOCAL_AI:return ae(t.payload)(e);default:return e}};!function(e){e[e.HOME=0]="HOME",e[e.ROOM=1]="ROOM",e[e.GAME=2]="GAME"}($||($={}));var se,ue,le=function(e,t){var n=Object(r.useState)($.HOME),i=n[0],a=n[1],o=function(e,t){var n=this,i=Object(r.useState)(t),a=i[0],o=i[1],c=Object(r.useState)(!1),s=(c[0],c[1]),u=Object(r.useState)(!1),l=(u[0],u[1]),f=Object(r.useMemo)((function(){return new U(e,F.make(t,o,10))}),[]);return Object(r.useEffect)((function(){return void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/smnet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_PEER_CONFIG:'{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:hkustracing.com:3478"},{"urls":"turn:hkustracing.com:3478","username":"player","credential":"player_password"}]}',REACT_APP_PEER_HOST:"peer.hkustracing.com",REACT_APP_PEER_PATH:"/",REACT_APP_PEER_PORT:"443",REACT_APP_PEER_SECURE:"true",REACT_APP_SMNET_VERBOSE_ALL_NO_HISTORY:"true"}).REACT_APP_DISABLE_SMNET_WINDOW_VAR&&(window.stateHistory=f.getHistory,window.smnetLog=T,window.network=f),function(){f.leave().catch(T.error)}}),[f]),Object.freeze({join:function(e,t){return S(n,void 0,void 0,(function(){return k(this,(function(n){switch(n.label){case 0:return s(!0),[4,f.join(e,t).finally((function(){s(!1)}))];case 1:return n.sent(),[2]}}))}))},leave:f.leave.bind(f),dispatch:function(e){return S(n,void 0,void 0,(function(){return k(this,(function(t){switch(t.label){case 0:return l(!0),[4,f.dispatch(e).finally((function(){l(!1)}))];case 1:return t.sent(),[2]}}))}))},state:a,connected:f.connected,connecting:f.connecting,dispatching:f.dispatching,networkName:f.getNetworkName(),isAdmin:f.isAdmin,myId:f.myId,kick:f.kick})}(function(e){return function(t,n){return e(ce(t,n),n)}}(e),t),c=o.state,s=o.myId,u=Object(r.useMemo)((function(){try{return c.nameDict[c.members[s]]}catch(e){return-1}}),[s,c]),l=Object(r.useMemo)((function(){try{return Object.keys(c.localPlayers).filter((function(e){return c.localPlayers[e]===s})).map((function(e){return c.members[e]}))}catch(e){return[]}}),[s,c]),f=Object(r.useMemo)((function(){try{return Object.keys(c.aiPlayers).filter((function(e){return c.aiPlayers[e]===s})).map((function(e){return c.members[e]}))}catch(e){return[]}}),[s,c]),h=function(e){return Object.keys(c.members).filter((function(t){return c.members[t]===c.players[e]}))[0]},d=function(e){return X(void 0,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,o.dispatch({type:W.RENAME,payload:e})];case 1:return t.sent(),[2]}}))}))},p=function(){return X(void 0,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return T.info("leaving"),[4,o.leave()];case 1:return e.sent(),[2]}}))}))};return Object(r.useEffect)((function(){o.state.started&&void 0!==o.networkName?a($.GAME):void 0!==o.networkName?a($.ROOM):a($.HOME)}),[o.state,o.networkName]),{connect:function(e,t){return X(void 0,void 0,void 0,(function(){var n;return Z(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,5]),T.info("connecting",t),[4,o.join(t)];case 1:return r.sent(),T.info("entering with name",e),[4,d(e)];case 2:return r.sent(),T.info("connected",t),[3,5];case 3:return n=r.sent(),T.error(n),[4,p()];case 4:throw r.sent(),n;case 5:return[2]}}))}))},connected:o.connected,connecting:o.connecting,dispatching:o.dispatching,gameAppState:i,state:c,room:o.networkName,leave:p,isAdmin:o.isAdmin,myId:s,kick:function(e){return X(void 0,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return T.info("leaving"),e in o.state.aiPlayers||e in o.state.localPlayers?[4,o.dispatch({type:W.REMOVE_LOCAL_AI,payload:e})]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,o.kick(e)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},ready:function(){return X(void 0,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,o.dispatch({type:W.READY})];case 1:return e.sent(),[2]}}))}))},start:function(){return X(void 0,void 0,void 0,(function(){return Z(this,(function(e){switch(e.label){case 0:return[4,o.dispatch({type:W.START})];case 1:return e.sent(),[2]}}))}))},dispatch:o.dispatch,addLocal:function(e){return X(void 0,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,o.dispatch({type:W.ADD_LOCAL,payload:e})];case 1:return t.sent(),[2]}}))}))},addAi:function(e){return X(void 0,void 0,void 0,(function(){return Z(this,(function(t){switch(t.label){case 0:return[4,o.dispatch({type:W.ADD_AI,payload:e})];case 1:return t.sent(),[2]}}))}))},playerType:function(e){var t,n="string"===typeof e?e:o.state.players[e],r=null===(t=Object.entries(o.state.members).find((function(e){e[0];var t=e[1];return n===t})))||void 0===t?void 0:t[0];return void 0===r?Y.NORMAL:r in o.state.aiPlayers?Y.AI:r in o.state.localPlayers?Y.LOCAL:Y.NORMAL},myPlayerId:u,myLocals:l,myAis:f,getPeerId:h,dispatchAs:function(e,t){return X(void 0,void 0,void 0,(function(){return Z(this,(function(n){switch(n.label){case 0:return[4,o.dispatch(V(V({},t),{peerId:h(e)}))];case 1:return n.sent(),[2]}}))}))}}},fe=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.turn=0,t}(function(e,t){function n(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(t,e)}(z),n(58)),he=n(183),de=n(182),pe=function(e){Object(he.a)(n,e);var t=Object(de.a)(n);function n(){var e;Object(fe.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).maxPlayer=4,e.minPlayer=4,e.turn=0,e.direction=1,e.points=0,e.dead={},e.drawDeck=[],e.trashDeck=[],e.playerDeck=[],e.winner=void 0,e.logs=[],e}return n}(z),ye=n(80),me=n(12);!function(e){e[e.PLAY_CARD=0]="PLAY_CARD",e[e.LOCAL_MOVE=1]="LOCAL_MOVE",e[e.END=2]="END"}(se||(se={})),function(e){e[e.SPADE=0]="SPADE",e[e.HEART=1]="HEART",e[e.CLUB=2]="CLUB",e[e.DIAMOND=3]="DIAMOND"}(ue||(ue={}));var ve={1:1,2:2,3:3,4:0,5:0,6:6,7:7,8:8,9:9,10:10,11:0,12:20,13:99},ge=function(e){var t=e.card;return function(e){return function(e){return 13===e.number}(t)?(e.points=99,Le(_e(e))):e}},be=function(e){return(e.suit!==ue.SPADE||1!==e.number)&&[1,2,3,6,7,8,9].includes(e.number)},we=function(e){var t=e.card;return function(e){if(be(t)){var n=e.points+ve[t.number];if(n>99)throw new Error("playing this card will exceed 99");return Le(_e(Object(me.a)(Object(me.a)({},e),{},{points:n})))}return e}},Ee=function(e){return 10===e.number||12===e.number},Oe=function(e){var t=e.card,n=e.increase;return function(e){if(Ee(t)){if(void 0===n)throw new Error("increase is required in payload");var r=e.points+(n?ve[t.number]:-ve[t.number]);if(r>99)throw new Error("playing this card will exceed 99");return Le(_e(Object(me.a)(Object(me.a)({},e),{},{points:r})))}return e}},Ae=function(e){var t=e.card;return function(e){return function(e){return 4===e.number}(t)?(e.direction*=-1,Le(_e(e))):e}},Se=function(e){var t=e.card;return function(e){return function(e){return 11===e.number}(t)?Le(_e(e)):e}},ke=function(e,t){var n=e.card,r=e.target;return function(e){if(function(e){return 5===e.number}(n)){if(void 0===r)throw new Error("target is required in payload");if(r===t)throw new Error("cannot target myself");return e.turn=r,Le(e)}return e}},Pe=function(e){var t=e.card;return function(e){return function(e){return 1===e.number&&e.suit===ue.SPADE}(t)?(e.points=1,Le(_e(e))):e}},Ce=function e(t){return function(n){if(n.playerDeck[t].length>=5)throw new Error("cannot draw, ".concat(n.players[t]," already has ").concat(5," cards"));var r=n.drawDeck.shift();return void 0===r?e(t)(Object(me.a)(Object(me.a)({},n),{},{drawDeck:te(n.trashDeck),trashDeck:[]})):(n.playerDeck[t].push(r),Object(me.a)({},n))}},je=function(e,t){var n=e.card;return function(e){return e.trashDeck.push(n),e.playerDeck[t]=e.playerDeck[t].filter((function(e){var t=e.suit,r=e.number;return!(t===n.suit&&r===n.number)})),e}},_e=function(e){var t=(e.turn+e.maxPlayer+e.direction)%e.maxPlayer;return Object(me.a)(Object(me.a)({},e),{},{turn:t})},Le=function e(t){return!t.dead[t.turn]&&function(e,t){var n=1/0,r=0;return t.forEach((function(t,i){var a=t.suit,o=t.number,c=0;if(a===ue.SPADE&&1===o)return[0,i];(c=10===o?e-10:12===o?e-20:13===o?99:e+ve[o])<n&&(n=c,r=i)})),[n,r]}(t.points,t.playerDeck[t.turn])[0]>99&&(t.logs.push("".concat(t.players[t.turn]," die, his card: ").concat(t.playerDeck[t.turn].map((function(e){return"".concat(ue[e.suit]).concat(e.number)})).join(","))),t.dead[t.turn]=!0),Object.keys(t.dead).length===t.players.length-1&&t.started&&(t.winner=[0,1,2,3].filter((function(e){return!t.dead[e]}))[0]),t.dead[t.turn]?e(_e(Object(me.a)(Object(me.a)({},t),{},{turn:t.turn}))):Object(me.a)(Object(me.a)({},t),{},{turn:t.turn})},De=function(e,t){var n=t.peerId;if(void 0===n)throw new Error("Expect peerId in action");switch(t.type){case W.START:return function(e){(e=Object(me.a)(Object(me.a)({},e),{},{drawDeck:[],trashDeck:[],playerDeck:[],points:0,direction:1,turn:0,dead:{},logs:["game started"],winner:void 0})).drawDeck=te(function(){for(var e=[],t=0;t<4;t++)for(var n=1;n<=13;n++)e.push({suit:t,number:n});return e}());for(var t=0;t<e.players.length;t++){e.playerDeck[t]=[];for(var n=0;n<5;n++)e=Ce(t)(e)}return Object(me.a)({},e)}(e);case se.PLAY_CARD:return function(e,t){return function(n){var r=t.card,i="".concat(ue[r.suit]).concat(r.number);if(void 0===n.playerDeck[e].find((function(e){var t=e.suit,n=e.number;return t===r.suit&&n===r.number})))throw new Error("".concat(n.players[e]," doesnt own card ").concat(i));if(n.turn!==e)throw new Error("not your turn");return ee.apply(void 0,[Ce(e)].concat(Object(ye.a)([je,ge,we,Oe,Ae,Se,ke,Pe].map((function(n){return n(t,e)})))))(n)}}(function(){var t=e.nameDict[e.members[n]];if(void 0===t)throw new Error("game not started");return t}(),t.payload)(g()(e));case se.END:return Object(me.a)(Object(me.a)({},e),{},{started:!1})}return e},Re=n(64),Ne=function(e){return[4,5,11,13].includes(e.number)},Te=function(e,t){var n=e.playerDeck[t],r=e.points,i=n.filter(be).sort((function(e,t){return ve[t.number]-ve[e.number]})),a=n.find((function(e){return 13===e.number}));if(void 0!==a&&99!==r&&i.length<3)return{type:se.PLAY_CARD,payload:{card:a}};var o,c=Object(Re.a)(i);try{for(c.s();!(o=c.n()).done;){var s=o.value;if(r+ve[s.number]<=99)return{type:se.PLAY_CARD,payload:{card:s}}}}catch(w){c.e(w)}finally{c.f()}var u,l=n.filter(Ee),f=Object(Re.a)(l.sort((function(e,t){return t.number-e.number})));try{for(f.s();!(u=f.n()).done;){var h=u.value;if(r+ve[h.number]<=99)return{type:se.PLAY_CARD,payload:{card:h,increase:!0}}}}catch(w){f.e(w)}finally{f.f()}var d=n.find(Ne);if(void 0!==d)return{type:se.PLAY_CARD,payload:{card:d,target:e.nameDict[te(e.players.filter((function(n,r){return!e.dead[r]&&r!==t})))[0]]}};var p,y=Object(Re.a)(l.sort((function(e,t){return e.number-t.number})));try{for(y.s();!(p=y.n()).done;){var m=p.value;if(r-ve[m.number]<=99)return{type:se.PLAY_CARD,payload:{card:m,increase:!1}}}}catch(w){y.e(w)}finally{y.f()}var v,g=Object(Re.a)(n);try{for(g.s();!(v=g.n()).done;){var b=v.value;if(r-ve[b.number]<=99)return{type:se.PLAY_CARD,payload:{card:b,increase:!1}}}}catch(w){g.e(w)}finally{g.f()}throw new Error("reached an edge case")},Ie=Object(r.createContext)(null),xe=function(){var e=Object(r.useContext)(Ie);if(null===e)throw new Error("please wrap it using withPoker99Network before calling this hook");return e},Me=function(){var e=xe(),t=e.state,n=e.dispatch,a=e.dispatchAs,o=e.myPlayerId,c=e.myLocals,s=e.hideDeck,h=e.setHideDeck,d=e.error,p=e.setError,y=e.renderedDeckId,m=Object(r.useState)(0),v=Object(f.a)(m,2),g=v[0],b=v[1],w=Object(r.useState)(!0),E=Object(f.a)(w,2),O=E[0],A=E[1],S=1===t.direction?">":"<",k=function(e){p(e.message)},P=function(e){return Object(l.a)(u.a.mark((function r(){var i;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i={type:se.PLAY_CARD,payload:{card:e,increase:O,target:g}},t.turn!==o){r.next=6;break}return r.next=4,n(i).then((function(){return p("")})).catch(k);case 4:r.next=9;break;case 6:if(!c.includes(t.players[t.turn])){r.next=9;break}return r.next=9,a(t.turn,i).then((function(){return p("")})).catch(k);case 9:case"end":return r.stop()}}),r)})))},C=function(e){var n;return null===(n=t.playerDeck[e])||void 0===n?void 0:n.map((function(e){return i.a.createElement("button",{key:10*e.number+e.suit,onClick:P(e)},ue[e.suit]," ",e.number)}))},j=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({type:se.END}).catch(k);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement("div",{style:{pointerEvents:"all"}},i.a.createElement("div",null,i.a.createElement("h3",null,t.points),i.a.createElement("h6",null,t.players[t.turn],"'","s turn"),""!==d&&i.a.createElement("div",{style:{color:"red"}},d),void 0!==t.winner&&null!==t.winner&&i.a.createElement("div",null,"winner is ",t.players[t.winner],i.a.createElement("button",{onClick:j},"again")),t.players.map((function(e,n){return i.a.createElement("span",{key:e,onClick:function(){return b(n)},style:{fontWeight:t.turn===n?"bold":"normal",textDecorationLine:t.dead[n]?"line-through":"none"}},e," ",S)})),i.a.createElement("div",null,0===c.length?C(o):s?i.a.createElement("button",{onClick:function(){return h(!1)}},"show ",t.players[y]):C(y)),i.a.createElement("div",null,"target: ",g),i.a.createElement("button",{onClick:function(){return A(!O)}},O?"+":"-")),i.a.createElement("div",null,t.logs.slice().reverse().map((function(e,t){return i.a.createElement("div",{key:t},e)}))))},He=n(5),Ke=n.n(He),Fe=n(82),Be=n(6086),Ge=n(6090),Ue=n(6091),We=n(65),Ye=n(6107),qe=n(6094),ze=n(49),Je=n(28),Ve=n(6093),Qe=n(6098),Xe=n(6092),Ze=n(6099),$e=n(6100),et=n(6101),tt=n(6102),nt=n(6111),rt=n(6104),it=n(6105),at=n(6106),ot=n(6108),ct=n(6095),st=n(6096),ut=n(6097),lt=n(6103),ft=n(81),ht=function(){return(ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function dt(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{s(r.next(e))}catch(t){a(t)}}function c(e){try{s(r.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((r=r.apply(e,t||[])).next())}))}function pt(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var yt={GameRenderer:Ke.a.node,gameAppState:Ke.a.number.isRequired,children:Ke.a.arrayOf(Ke.a.node.isRequired).isRequired,fullPage:Ke.a.arrayOf(Ke.a.bool)},mt=function(e){var t=e.GameRenderer,n=e.gameAppState,r=e.children,a=e.fullPage,o=void 0===a?[!1,!1,!0]:a;return i.a.createElement("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"relative"}},t,null===r||void 0===r?void 0:r.slice().reverse().map((function(e,t){var a,c,s,u=r.length-1-t;return i.a.createElement("div",{key:t,style:ht(ht(ht({},(null===o||void 0===o?void 0:o[u])?{pointerEvents:"none"}:{justifyContent:"center",alignItems:"center"}),{display:"flex",height:"100vh",width:"100vw",left:100*-(n-u)+"%",position:"absolute"}),(a=.3,c=["left"],s="linear",void 0===s&&(s="ease"),{transition:c.map((function(e){return a+"s "+e+" "+s})).join(",")}))},e)})))};mt.propTypes=yt;var vt=function(){return Object(Fe.c)({dictionaries:[Fe.b,Fe.a],style:"capital",separator:" "})},gt={children:Ke.a.node,loading:Ke.a.bool.isRequired,size:Ke.a.number},bt=function(e){var t;return i.a.createElement("div",{style:{position:"relative"}},e.children,e.loading&&i.a.createElement(Be.a,{size:null!==(t=e.size)&&void 0!==t?t:24,style:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}))};bt.propTypes=gt;var wt=function(e){var t=e.connect,n=e.connecting,a=Object(r.useState)(vt()),o=a[0],c=a[1],s=Object(r.useState)(""),u=s[0],l=s[1],f=Object(r.useState)(""),h=f[0],d=f[1];return i.a.createElement(Ge.a,{elevation:3,style:{padding:"32px 64px"}},i.a.createElement(Ue.a,{container:!0,justify:"flex-end",direction:"column",spacing:3},i.a.createElement(Ue.a,{item:!0},i.a.createElement(We.a,{variant:"h5"},"Welcome to Poker 99")),i.a.createElement(Ue.a,{item:!0},i.a.createElement(Ye.a,{label:"Your Name",value:o,onChange:function(e){var t=e.target.value;return c(t)},fullWidth:!0})),i.a.createElement(Ue.a,{item:!0},i.a.createElement(Ye.a,{label:"Room Code",value:u,onChange:function(e){var t=e.target.value;return l(t)},fullWidth:!0})),""!==h&&i.a.createElement(ot.a,{severity:"error"},h),i.a.createElement(Ue.a,{item:!0,container:!0,justify:"flex-end"},i.a.createElement(bt,{loading:n},i.a.createElement(qe.a,{color:"primary",variant:"contained",disabled:""===o||""===u||n,onClick:function(){return dt(void 0,void 0,void 0,(function(){return pt(this,(function(e){switch(e.label){case 0:return[4,t(o,u).catch((function(e){return d(e.message)}))];case 1:return[2,e.sent()]}}))}))}},"join")))))},Et=function(){return i.a.createElement(ze.a,null,i.a.createElement("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},i.a.createElement("path",{d:"M12,5.5c2.2,0,4,1.8,4,4s-1.8,4-4,4s-4-1.8-4-4S9.8,5.5,12,5.5 M12,7.5c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2\r\n            S13.1,7.5,12,7.5 M12,14.5c2.7,0,8,1.3,8,4v3H4v-3C4,15.8,9.3,14.5,12,14.5 M12,16.4c-3,0-6.1,1.5-6.1,2.1v1.1h12.2v-1.1\r\n            C18.1,17.9,15,16.4,12,16.4z"}),i.a.createElement("path",{d:"M17.9,1.8v3h-3v2h3v3h2v-3h3v-2h-3v-3H17.9z"})))},Ot=function(){return i.a.createElement(ze.a,null,i.a.createElement("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},i.a.createElement("path",{d:"M11,4c1,0,1.7,0.8,1.7,1.7c0,0.6-0.3,1.2-0.9,1.5v1.1h0.9c3.3,0,6.1,2.7,6.1,6.1l0,0h0.9c0.5,0,0.9,0.4,0.9,0.9v2.6\r\n  c0,0.5-0.4,0.9-0.9,0.9H19v0.9c0,1-0.8,1.7-1.7,1.7H5.1c-1,0-1.7-0.8-1.7-1.7v-0.9H2.5c-0.5,0-0.9-0.4-0.9-0.9v-2.6\r\n  c0-0.5,0.4-0.9,0.9-0.9h0.9c0-3.3,2.7-6.1,6.1-6.1h0.9V7.2C9.8,7,9.5,6.4,9.5,5.8C9.5,4.8,10.2,4,11.2,4 M7.3,13.5\r\n  c-1.2,0-2.2,1-2.2,2.2c0,1.2,1,2.2,2.2,2.2s2.2-1,2.2-2.2C9.5,14.5,8.5,13.5,7.3,13.5 M15.1,13.5c-1.2,0-2.2,1-2.2,2.2\r\n  c0,1.2,1,2.2,2.2,2.2s2.2-1,2.2-2.2C17.2,14.5,16.3,13.5,15.1,13.5z"}),i.a.createElement("path",{d:"M17.9,1.8v3h-3v2h3v3h2v-3h3v-2h-3v-3H17.9z"})))},At=function(e){var t=e.room,n=e.state,a=e.leave,o=e.isAdmin,c=e.myId,s=e.kick,u=e.ready,l=e.start,f=e.addAi,h=e.addLocal,d=e.playerType,p=e.dispatching,y=Object(r.useState)(""),m=y[0],v=y[1],g=Object(r.useState)(""),b=g[0],w=g[1],E=Object(r.useState)(void 0),O=E[0],A=E[1],S=Object(Je.a)(),k=function(){w(""),A(void 0)},P=function(e,t){return e===n.networkName?t+" is the host":e in n.spectators?t+" is a spectator":e in n.localPlayers?t+" is a local player of "+n.members[n.localPlayers[e]]:e in n.aiPlayers?t+" is an ai player of "+n.members[n.aiPlayers[e]]:n.ready[e]?t+" is not ready yet":t+" is ready"};return i.a.createElement(Ge.a,{elevation:3,style:{padding:"32px 64px",width:"400px"}},i.a.createElement(Ue.a,{container:!0,justify:"flex-end",direction:"column",spacing:3},i.a.createElement(Ue.a,{item:!0},i.a.createElement(We.a,{variant:"h5"},"Room: ",t)),i.a.createElement(Ue.a,{item:!0},i.a.createElement(Ue.a,{container:!0,justify:"space-between",alignItems:"flex-end"},i.a.createElement(Ue.a,{item:!0},i.a.createElement(We.a,{variant:"h6"},"Players")),i.a.createElement(Ue.a,{item:!0},i.a.createElement(Ve.a,{size:"medium",title:"Add Local Hot Seat player",onClick:function(){return A(!0)}},i.a.createElement(Et,null)),i.a.createElement(Ve.a,{size:"medium",title:"Add AI Player",onClick:function(){return dt(void 0,void 0,void 0,(function(){return pt(this,(function(e){switch(e.label){case 0:return[4,f(vt()).catch((function(e){return v(e.message)}))];case 1:return e.sent(),[2]}}))}))}},i.a.createElement(Ot,null)))),i.a.createElement(Qe.a,null),i.a.createElement(Xe.a,null,Object.entries(n.members).map((function(e){var t=e[0],r=e[1],a=t===n.networkName||[Y.LOCAL,Y.AI].includes(d(r))?S.palette.primary.main:n.ready[t]?S.palette.success.main:S.palette.text.secondary;return i.a.createElement(Ze.a,{key:t,title:P(t,r),style:{color:a}},i.a.createElement($e.a,null,i.a.createElement("span",{style:{color:a}},function(e,t){return e in n.spectators?i.a.createElement(Ue.a,{item:!0,title:"spectator"},i.a.createElement(ct.a,null)):n.networkName===e?i.a.createElement(Ue.a,{item:!0,title:"host"},i.a.createElement(ft.b,null)):d(t)===Y.NORMAL?n.ready[e]?i.a.createElement(Ue.a,{item:!0,title:"player ready"},i.a.createElement(ft.a,null)):i.a.createElement(Ue.a,{item:!0,title:"player not ready"},i.a.createElement(st.a,null)):d(t)===Y.LOCAL?i.a.createElement(Ue.a,{item:!0,title:"hot seat player"},i.a.createElement(ut.a,null)):d(t)===Y.AI?i.a.createElement(Ue.a,{item:!0,title:"AI player"},i.a.createElement(ft.c,null)):void 0}(t,r))),i.a.createElement(et.a,null,r),(o||[Y.LOCAL,Y.AI].includes(d(r)))&&t!==c&&t!==n.networkName&&i.a.createElement(tt.a,null,i.a.createElement(Ve.a,{edge:"end","aria-label":"delete",onClick:function(){return s(t)},title:"Kick"},i.a.createElement(lt.a,{color:"error"}))))})))),""!==m&&i.a.createElement(ot.a,{severity:"error"},m),i.a.createElement(Ue.a,{item:!0,container:!0,justify:"flex-end",spacing:1},i.a.createElement(Ue.a,{item:!0},i.a.createElement(qe.a,{variant:"contained",color:"secondary",onClick:a},"leave")),i.a.createElement(Ue.a,{item:!0},i.a.createElement(bt,{loading:p},o?i.a.createElement(qe.a,{variant:"contained",color:"primary",disabled:p,onClick:function(){return dt(void 0,void 0,void 0,(function(){return pt(this,(function(e){switch(e.label){case 0:return[4,l().catch((function(e){return v(e.message)}))];case 1:return e.sent(),[2]}}))}))}},"start"):i.a.createElement(qe.a,{variant:"contained",color:"primary",disabled:p,onClick:function(){return dt(void 0,void 0,void 0,(function(){return pt(this,(function(e){switch(e.label){case 0:return[4,u().catch((function(e){return v(e.message)}))];case 1:return e.sent(),[2]}}))}))}},n.ready[null!==c&&void 0!==c?c:""]?"unready":"ready"))))),i.a.createElement(nt.a,{open:void 0!==O,onClose:k,"aria-labelledby":"form-dialog-title"},i.a.createElement(rt.a,{id:"form-dialog-title"},"Name for new ",!0===O?"local":"AI"," player"),i.a.createElement(it.a,null,i.a.createElement(Ye.a,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,value:b,onChange:function(e){var t=e.target;return w(t.value)}})),i.a.createElement(at.a,null,i.a.createElement(qe.a,{onClick:k,color:"primary"},"Cancel"),i.a.createElement(qe.a,{onClick:function(){return dt(void 0,void 0,void 0,(function(){return pt(this,(function(e){switch(e.label){case 0:return""===b?[3,4]:!0!==O?[3,2]:[4,h(b).catch((function(e){return v(e.message)}))];case 1:return e.sent(),[3,4];case 2:return!1!==O?[3,4]:[4,f(b).catch((function(e){return v(e.message)}))];case 3:e.sent(),e.label=4;case 4:return k(),[2]}}))}))},color:"primary"},"Create"))))},St=function(e){var t=function(t){var n=function(e,t,n){var i=le(function(e){return function(t,n){return e(t,n)}}(e),t),a=i.myLocals,o=i.myPlayerId,c=i.myAis,s=i.dispatchAs,u=i.state,l=Object(r.useState)(""),f=l[0],h=l[1],d=Object(r.useState)(a.length>0),p=d[0],y=d[1],m=Object(r.useState)(o),v=m[0],g=m[1],b=Object(r.useRef)(-1);u.turn!==b.current&&(a.length>0&&(p=!0,y(!0),g(u.turn)),b.current=u.turn);var w=function(e){h(e.message)};return Object(r.useEffect)((function(){if(c.includes(u.players[u.turn])&&u.started&&void 0===u.winner){var e=window.setTimeout((function(){var e=n(u,u.turn);s(u.turn,e).catch(w)}),500);return function(){window.clearTimeout(e)}}}),[u]),V(V({},i),{state:u,hideDeck:p,setHideDeck:y,error:f,setError:h,renderedDeckId:v})}(De,new pe,Te);return i.a.createElement(Ie.Provider,{value:n},i.a.createElement(e,t))};return t.displayName="WithGameNetwork",t}((function(){var e=xe();return i.a.createElement(mt,{gameAppState:e.gameAppState,fullPage:[!1,!1,!0]},i.a.createElement(wt,e),i.a.createElement(At,e),i.a.createElement(Me,null))}));o.a.render(i.a.createElement(St,null),document.getElementById("root")),c()}},[[5943,1,2]]]);
//# sourceMappingURL=main.0bdd6fea.chunk.js.map